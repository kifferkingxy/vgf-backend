<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VGF Service Planer</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --bg-tertiary: #f9fafb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            --border-color: #e5e7eb;
            --border-color-light: #f3f4f6;
            --sidebar-bg: #1f2937;
            --sidebar-text: #d1d5db;
            --sidebar-hover: #374151;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode {
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-tertiary: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --border-color: #374151;
            --border-color-light: #4b5563;
            --sidebar-bg: #111827;
            --sidebar-text: #d1d5db;
            --sidebar-hover: #1f2937;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-secondary);
            overflow: hidden;
            transition: background 0.3s, color 0.3s;
        }
        
        /* Login Screen */
        .login-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-box {
            background: white;
            border-radius: 1.5rem;
            padding: 3rem 2.5rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            max-width: 420px;
            width: 90%;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .login-logo-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 1rem;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }
        
        .login-title {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            color: #6366f1;
            margin-bottom: 0.25rem;
        }
        
        .login-subtitle {
            text-align: center;
            color: #94a3b8;
            font-size: 1rem;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.9375rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all 0.2s;
            background: #1e293b;
            color: white;
        }
        
        .form-input::placeholder {
            color: #64748b;
        }
        
        .form-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            background: #1e293b;
        }
        
        .btn-login {
            width: 100%;
            padding: 1rem;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 1.0625rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 0.5rem;
        }
        
        .btn-login:hover {
            background: #4f46e5;
        }
        
        /* Main Layout */
        .app-container {
            display: flex;
            height: 100vh;
            background: #f3f4f6;
        }
        
        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            color: white;
            display: flex;
            flex-direction: column;
            transition: width 0.3s;
        }
        
        .sidebar.collapsed {
            width: 0;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .sidebar-logo svg {
            width: 48px;
            height: 48px;
        }
        
        .sidebar-logo-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .sidebar-logo-text p {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            color: #d1d5db;
            background: transparent;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            width: 100%;
            font-size: 0.9375rem;
            transition: all 0.2s;
            margin-bottom: 0.5rem;
        }
        
        .nav-item:hover {
            background: var(--sidebar-hover);
            color: white;
        }
        
        .nav-item.active {
            background: #10b981;
            color: white;
        }
        
        .nav-item svg {
            width: 20px;
            height: 20px;
        }
        
        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .user-email {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .menu-btn {
            padding: 0.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: background 0.2s;
            color: var(--text-primary);
        }
        
        .menu-btn:hover {
            background: var(--bg-tertiary);
        }
        
        .header-title h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .header-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .icon-btn {
            position: relative;
            padding: 0.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: background 0.2s;
            color: var(--text-primary);
        }
        
        .icon-btn:hover {
            background: var(--bg-tertiary);
        }
        
        .icon-btn .badge {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
        }
        
        .btn-primary {
            padding: 0.625rem 1rem;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.2s;
        }
        
        .btn-primary:hover {
            background: #059669;
        }
        
        .btn-danger {
            padding: 0.625rem 1rem;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.2s;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        /* Content Area */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--from), var(--to));
            border-radius: 0.75rem;
            padding: 1.5rem;
            color: white;
        }
        
        .stat-card.green {
            --from: #10b981;
            --to: #059669;
        }
        
        .stat-card.emerald {
            --from: #10b981;
            --to: #047857;
        }
        
        .stat-card.orange {
            --from: #f97316;
            --to: #ea580c;
        }
        
        .stat-card.blue {
            --from: #3b82f6;
            --to: #2563eb;
        }
        
        .stat-icon {
            opacity: 0.8;
            margin-bottom: 0.75rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        /* Cards */
        .card {
            background: var(--bg-primary);
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        /* Table */
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            text-align: left;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }
        
        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color-light);
            color: var(--text-primary);
        }
        
        .table tr:hover {
            background: var(--bg-tertiary);
        }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-green {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-red {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-blue {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-purple {
            background: #e9d5ff;
            color: #6b21a8;
        }
        
        .badge-gray {
            background: #f3f4f6;
            color: #374151;
        }
        
        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        
        /* Employee List */
        .employee-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color-light);
        }
        
        .employee-item:last-child {
            border-bottom: none;
        }
        
        .employee-item:hover {
            background: var(--bg-tertiary);
        }
        
        .employee-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .employee-avatar-large {
            width: 48px;
            height: 48px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.125rem;
        }
        
        .employee-details {
            flex: 1;
        }
        
        .employee-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .employee-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .employee-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-icon {
            padding: 0.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-icon.edit {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .btn-icon.edit:hover {
            background: #bfdbfe;
        }
        
        .btn-icon.delete {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .btn-icon.delete:hover {
            background: #fecaca;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: #ffffff;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        body.dark-mode .modal {
            background: #ffffff;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #ffffff;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }
        
        .close-btn {
            padding: 0.5rem;
            background: #f3f4f6;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #111827;
        }
        
        .close-btn:hover {
            background: #e5e7eb;
        }
        
        .modal-body {
            padding: 1.5rem;
            background: #ffffff;
        }
        
        .modal-body .form-label {
            color: #111827;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .modal-body .form-input,
        .modal-body select {
            background: #ffffff;
            color: #111827;
            border: 2px solid var(--border-color);
            font-size: 1rem;
            padding: 0.875rem 1rem;
        }
        
        body.dark-mode .modal-body .form-input,
        body.dark-mode .modal-body select {
            background: #ffffff;
            color: #111827;
        }
        
        .modal-body select {
            font-weight: 500;
        }
        
        .modal-body select option {
            background: #ffffff;
            color: #111827;
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 500;
        }
        
        body.dark-mode .modal-body select option {
            background: #ffffff;
            color: #111827;
        }
        
        .modal-body .form-input:focus,
        .modal-body select:focus {
            background: #ffffff;
            color: #111827;
            border-color: #10b981;
            outline: none;
        }
        
        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        .btn-secondary {
            flex: 1;
            padding: 0.75rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: #f9fafb;
        }
        
        .btn-submit {
            flex: 1;
            padding: 0.75rem;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-submit:hover {
            background: #059669;
        }
        
        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Search */
        .search-wrapper {
            position: relative;
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.75rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .search-input:focus {
            outline: none;
            border-color: #10b981;
        }
        
        /* Permission Checkboxes */
        .permissions-group {
            background: var(--bg-tertiary);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .permissions-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .permission-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .permission-item:last-child {
            margin-bottom: 0;
        }
        
        .permission-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .permission-item label {
            font-size: 0.875rem;
            color: var(--text-primary);
            cursor: pointer;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-tertiary);
        }
        
        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1rem;
            color: var(--text-tertiary);
        }
        
        .empty-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .empty-text {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }
        
        /* Dark Mode Toggle */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .toggle-label {
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: #e5e7eb;
            border-radius: 9999px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: #10b981;
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }
        
        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .text-positive { color: #10b981; }
        .text-negative { color: #ef4444; }
        
        /* Icons using SVG */
        svg {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-overlay">
        <div class="login-box">
            <div class="login-logo">
                <div class="login-logo-icon">
                    üõ°Ô∏è
                </div>
            </div>
            <h2 class="login-title">VGF Service</h2>
            <p class="login-subtitle">Online Planer Pro</p>
            
            <div class="form-group">
                <label class="form-label">Benutzername</label>
                <input type="text" id="loginUsername" class="form-input" placeholder="Benutzername" autocomplete="username">
            </div>
            
            <div class="form-group">
                <label class="form-label">Passwort</label>
                <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
            </div>
            
            <button type="button" class="btn-login" onclick="handleLogin()">Anmelden</button>
            
            <div id="loginError" style="margin-top: 1rem; padding: 0.75rem; background: #fee2e2; color: #991b1b; border-radius: 0.75rem; font-size: 0.875rem; display: none;">
                Ung√ºltige Anmeldedaten
            </div>
            
            <!-- Nur f√ºr Entwicklungsmodus -->
            <div id="devHint" style="margin-top: 1rem; padding: 0.5rem; background: #fef3c7; border-radius: 0.5rem; font-size: 0.75rem; color: #92400e; text-align: center; display: none;">
                üîß Entwicklungsmodus
            </div>
            
            <!-- Sync Status -->
            <div id="connectionStatus" style="margin-top: 1rem; padding: 0.75rem; border-radius: 0.75rem; display: none;">
                <div style="display: flex; align-items: center; gap: 0.75rem; font-size: 0.875rem;">
                    <span id="statusDot" style="width: 10px; height: 10px; border-radius: 50%; display: inline-block;"></span>
                    <span id="statusText">Verbinde...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="app-container hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <svg viewBox="0 0 100 100">
                        <defs>
                            <linearGradient id="vgfGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#4ade80" />
                                <stop offset="100%" style="stop-color:#22c55e" />
                            </linearGradient>
                        </defs>
                        <path d="M 10 15 L 25 60 L 20 60 L 10 30 Z" fill="url(#vgfGradient2)" />
                        <path d="M 10 15 L 30 70 L 25 70 L 10 30 Z" fill="url(#vgfGradient2)" />
                        <path d="M 35 15 L 60 15 L 60 25 L 45 25 L 45 60 L 60 60 L 60 45 L 50 45 L 50 35 L 70 35 L 70 70 L 35 70 Z" fill="url(#vgfGradient2)" />
                        <path d="M 75 15 L 95 15 L 95 25 L 85 25 L 85 40 L 93 40 L 93 50 L 85 50 L 85 70 L 75 70 Z" fill="url(#vgfGradient2)" />
                    </svg>
                    <div class="sidebar-logo-text">
                        <h1>VGF Service</h1>
                        <p>Online Planer</p>
                        <div id="onlineStatus" style="font-size: 0.625rem; color: #10b981; display: flex; align-items: center; gap: 0.25rem; margin-top: 0.25rem;">
                            <span id="onlineDot" style="width: 6px; height: 6px; background: #10b981; border-radius: 50%; display: inline-block;"></span>
                            <span id="onlineText">Online</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <nav class="sidebar-nav" id="navigation">
                <!-- Navigation wird dynamisch geladen -->
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">MV</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Marvin</div>
                        <div class="user-email" id="userEmail">marvinVGF</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-top">
                    <div class="header-left">
                        <button class="menu-btn" onclick="toggleSidebar()">
                            <svg id="menuIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <line x1="3" y1="18" x2="21" y2="18"></line>
                            </svg>
                        </button>
                        <div class="header-title">
                            <h2 id="viewTitle">Dashboard</h2>
                            <p class="header-subtitle" id="currentDate"></p>
                        </div>
                    </div>
                    <div class="header-right">
                        <!-- Sync Status -->
                        <div id="syncStatus" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; background: #d1fae5; border-radius: 0.5rem; font-size: 0.75rem; color: #065f46;">
                            <span id="syncIcon">üîÑ</span>
                            <span id="syncText">Echtzeit</span>
                        </div>
                        
                        <button type="button" class="btn-danger" onclick="handleLogout()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Abmelden
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Content -->
            <main class="content" id="mainContent">
                <!-- Wird dynamisch geladen -->
            </main>
        </div>
    </div>

    <script>
        // ============================================
        // FIREBASE KONFIGURATION
        // ============================================
        // ERSTELLE EIN FIREBASE-PROJEKT UNTER: https://firebase.google.com
        const firebaseConfig = {
            apiKey: "DEIN_API_KEY_HIER",
            authDomain: "DEIN_PROJEKT.firebaseapp.com",
            databaseURL: "https://DEIN_PROJEKT-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "DEIN_PROJEKT",
            storageBucket: "DEIN_PROJEKT.appspot.com",
            messagingSenderId: "DEIN_SENDER_ID",
            appId: "DEIN_APP_ID"
        };

        // Firebase initialisieren
        let app;
        let auth;
        let database;
        let isOnline = true;
        let offlineMode = false;
        
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            database = firebase.database();
            console.log("‚úÖ Firebase initialisiert");
        } catch (error) {
            console.warn("‚ö†Ô∏è Firebase konnte nicht initialisiert werden");
            offlineMode = true;
        }

        // ============================================
        // HAUPTADMIN KONFIGURATION (VERSTECKT)
        // ============================================
        const MAIN_ADMIN = {
            username: "marvinVGF",
            password: "vgf123",
            name: "Marvin",
            role: "admin",
            id: "admin-marvin-permanent"
        };

        // Rollen-Definition
        const ROLES = {
            admin: { label: 'Administrator', color: 'red', level: 100 },
            kleinadmin: { label: 'Kleinadmin', color: 'orange', level: 90 },
            einsatzleiter: { label: 'Einsatzleiter', color: 'purple', level: 80 },
            supervisor: { label: 'Supervisor', color: 'purple', level: 70 },
            teamleader: { label: 'Schichtleiter', color: 'blue', level: 60 },
            security_guard: { label: 'Sicherheitsmitarbeiter', color: 'gray', level: 10 },
            trainee: { label: 'Auszubildender', color: 'gray', level: 5 },
            doorman: { label: 'T√ºrsteher', color: 'gray', level: 10 },
            event_security: { label: 'Veranstaltungsschutz', color: 'gray', level: 10 },
            ordner: { label: 'Ordner', color: 'gray', level: 10 },
            reception: { label: 'Pforte/Empfang', color: 'gray', level: 10 }
        };

        // Navigation Items
        const navigationItems = [
            { id: 'dashboard', label: 'Dashboard', icon: 'chart', adminOnly: true },
            { id: 'planning', label: 'Einsatzplanung', icon: 'calendar', adminOnly: false },
            { id: 'employees', label: 'Mitarbeiter', icon: 'users', adminOnly: true },
            { id: 'timekeeping', label: 'Zeiterfassung', icon: 'clock', adminOnly: false },
            { id: 'control', label: 'Einsatzzentrale', icon: 'map', adminOnly: true },
            { id: 'reports', label: 'Berichte', icon: 'download', adminOnly: true },
            { id: 'settings', label: 'Einstellungen', icon: 'settings', adminOnly: false }
        ];

        // App State
        let currentUser = null;
        let currentView = 'dashboard';
        let sidebarOpen = true;
        let users = [];
        let shifts = [];
        let timeEntries = [];
        let selectedDate = new Date().toISOString().split('T')[0];
        let activeTimer = null;
        
        // Firebase Listeners
        let usersRef;
        let shiftsRef;
        let timeEntriesRef;
        let activeListeners = [];

        // ============================================
        // INITIALISIERUNG
        // ============================================
        function init() {
            // Firebase Connection Listener
            if (database) {
                const connectedRef = database.ref(".info/connected");
                connectedRef.on("value", (snap) => {
                    isOnline = snap.val() === true;
                    updateConnectionStatus(isOnline, isOnline ? "Online" : "Offline");
                    
                    if (isOnline && !offlineMode) {
                        setupFirebaseListeners();
                    }
                });
            }
            
            // Lokale Daten laden
            loadLocalData();
            ensureMainAdmin();
            updateCurrentDate();
            setInterval(updateCurrentDate, 60000);
            
            // Enter-Key f√ºr Login
            document.getElementById('loginUsername').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            
            // Entwickler-Hinweis nur auf localhost
            if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
                document.getElementById('devHint').style.display = 'block';
            }
            
            console.log("üîß VGF Service Planer gestartet");
        }

        // ============================================
        // HAUPTPUNKT: MAIN ADMIN SICHERSTELLEN
        // ============================================
        function ensureMainAdmin() {
            const mainAdminExists = users.some(u => u.id === MAIN_ADMIN.id);
            
            if (!mainAdminExists) {
                console.log("üìã Erstelle Hauptadmin...");
                
                const mainAdmin = {
                    id: MAIN_ADMIN.id,
                    name: MAIN_ADMIN.name,
                    username: MAIN_ADMIN.username,
                    password: MAIN_ADMIN.password,
                    role: MAIN_ADMIN.role,
                    regNumber: "ADMIN-001",
                    email: "marvin@vgf-service.de",
                    phone: "",
                    status: 'aktiv',
                    hours: 0,
                    overtime: 0,
                    pushNotification: true,
                    lastSeen: new Date().toLocaleString('de-DE'),
                    permissions: {
                        canManageShifts: true,
                        canManageEmployees: true,
                        canAssignShifts: true,
                        canViewAllShifts: true,
                        canEditOwnShifts: true,
                        canDeleteEverything: true,
                        isSuperAdmin: true
                    },
                    createdAt: new Date().toISOString(),
                    isMainAdmin: true
                };
                
                users.push(mainAdmin);
                console.log("‚úÖ Hauptadmin erstellt");
                
                if (isOnline && database && !offlineMode) {
                    syncMainAdminToFirebase(mainAdmin);
                }
                
                saveLocalData();
            } else {
                const mainAdminIndex = users.findIndex(u => u.id === MAIN_ADMIN.id);
                if (mainAdminIndex !== -1) {
                    users[mainAdminIndex].permissions = {
                        canManageShifts: true,
                        canManageEmployees: true,
                        canAssignShifts: true,
                        canViewAllShifts: true,
                        canEditOwnShifts: true,
                        canDeleteEverything: true,
                        isSuperAdmin: true
                    };
                    users[mainAdminIndex].isMainAdmin = true;
                    
                    saveLocalData();
                    if (isOnline && database && !offlineMode) {
                        syncMainAdminToFirebase(users[mainAdminIndex]);
                    }
                }
            }
        }
        
        function syncMainAdminToFirebase(mainAdmin) {
            if (!database || offlineMode) return;
            
            try {
                database.ref('users/' + MAIN_ADMIN.id).set(mainAdmin);
                console.log("‚úÖ Hauptadmin zu Firebase gesynct");
            } catch (error) {
                console.error("Fehler beim Sync des Hauptadmins:", error);
            }
        }

        // ============================================
        // FIREBASE FUNKTIONEN
        // ============================================
        function setupFirebaseListeners() {
            if (!database || offlineMode) return;
            
            activeListeners.forEach(ref => ref.off());
            activeListeners = [];
            
            console.log("üîÑ Firebase Listener werden eingerichtet...");
            
            // Users Listener
            usersRef = database.ref('users');
            usersRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const firebaseUsers = Object.values(data);
                    
                    const mainAdminInFirebase = firebaseUsers.some(u => u.id === MAIN_ADMIN.id);
                    if (!mainAdminInFirebase) {
                        const mainAdmin = users.find(u => u.id === MAIN_ADMIN.id);
                        if (mainAdmin) {
                            syncMainAdminToFirebase(mainAdmin);
                        }
                    }
                    
                    const mergedUsers = [...firebaseUsers];
                    
                    const localMainAdmin = users.find(u => u.id === MAIN_ADMIN.id);
                    if (localMainAdmin) {
                        const existingIndex = mergedUsers.findIndex(u => u.id === MAIN_ADMIN.id);
                        if (existingIndex !== -1) {
                            mergedUsers[existingIndex] = localMainAdmin;
                        } else {
                            mergedUsers.push(localMainAdmin);
                        }
                    }
                    
                    users = mergedUsers;
                    console.log('üë• Users aktualisiert:', users.length);
                    
                    localStorage.setItem('vgf_users_cloud', JSON.stringify(users));
                    
                    if (currentUser) {
                        renderNavigation();
                        if (currentView === 'employees' || currentView === 'dashboard') {
                            renderContent();
                        }
                    }
                }
            });
            activeListeners.push(usersRef);
            
            // Shifts Listener
            shiftsRef = database.ref('shifts');
            shiftsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                shifts = data ? Object.values(data) : [];
                console.log('üìÖ Shifts aktualisiert:', shifts.length);
                
                localStorage.setItem('vgf_shifts_cloud', JSON.stringify(shifts));
                
                if (currentUser && (currentView === 'planning' || currentView === 'dashboard' || currentView === 'control')) {
                    renderContent();
                }
            });
            activeListeners.push(shiftsRef);
            
            // Time Entries Listener
            timeEntriesRef = database.ref('timeEntries');
            timeEntriesRef.on('value', (snapshot) => {
                const data = snapshot.val();
                timeEntries = data ? Object.values(data) : [];
                console.log('‚è±Ô∏è TimeEntries aktualisiert:', timeEntries.length);
                
                localStorage.setItem('vgf_time_entries_cloud', JSON.stringify(timeEntries));
                
                if (currentUser && currentView === 'timekeeping') {
                    renderContent();
                }
            });
            activeListeners.push(timeEntriesRef);
            
            updateSyncStatus(true);
        }

        function saveDataToFirebase(type, data) {
            if (!database || offlineMode) {
                saveLocalData();
                return false;
            }
            
            try {
                const ref = database.ref(type);
                if (Array.isArray(data)) {
                    const firebaseData = {};
                    data.forEach(item => {
                        if (item.id) {
                            firebaseData[item.id] = item;
                        }
                    });
                    ref.set(firebaseData);
                }
                updateSyncStatus(true);
                return true;
            } catch (error) {
                console.error('Fehler beim Speichern in Firebase:', error);
                updateSyncStatus(false);
                return false;
            }
        }

        // ============================================
        // DATEN-MANAGEMENT
        // ============================================
        function loadLocalData() {
            try {
                const cloudUsers = localStorage.getItem('vgf_users_cloud');
                const cloudShifts = localStorage.getItem('vgf_shifts_cloud');
                const cloudTimeEntries = localStorage.getItem('vgf_time_entries_cloud');
                
                if (cloudUsers) {
                    const parsedUsers = JSON.parse(cloudUsers);
                    const mainAdminIndex = parsedUsers.findIndex(u => u.id === MAIN_ADMIN.id);
                    if (mainAdminIndex !== -1) {
                        parsedUsers[mainAdminIndex].permissions = {
                            canManageShifts: true,
                            canManageEmployees: true,
                            canAssignShifts: true,
                            canViewAllShifts: true,
                            canEditOwnShifts: true,
                            canDeleteEverything: true,
                            isSuperAdmin: true
                        };
                        parsedUsers[mainAdminIndex].isMainAdmin = true;
                    }
                    users = parsedUsers;
                } else {
                    users = JSON.parse(localStorage.getItem('vgf_users') || '[]');
                }
                
                if (cloudShifts) {
                    shifts = JSON.parse(cloudShifts);
                } else {
                    shifts = JSON.parse(localStorage.getItem('vgf_shifts') || '[]');
                }
                
                if (cloudTimeEntries) {
                    timeEntries = JSON.parse(cloudTimeEntries);
                } else {
                    timeEntries = JSON.parse(localStorage.getItem('vgf_time_entries') || '[]');
                }
            } catch (error) {
                console.error("Fehler beim Laden der Daten:", error);
                users = [];
                shifts = [];
                timeEntries = [];
            }
            
            ensureMainAdmin();
        }

        function saveLocalData() {
            try {
                localStorage.setItem('vgf_users', JSON.stringify(users));
                localStorage.setItem('vgf_shifts', JSON.stringify(shifts));
                localStorage.setItem('vgf_time_entries', JSON.stringify(timeEntries));
            } catch (error) {
                console.error("Fehler beim lokalen Speichern:", error);
            }
        }

        function saveData() {
            console.log("üíæ Speichere Daten...");
            
            ensureMainAdmin();
            
            if (isOnline && !offlineMode && database) {
                console.log("üåê Synchronisiere mit Firebase...");
                
                const usersSuccess = saveDataToFirebase('users', users);
                const shiftsSuccess = saveDataToFirebase('shifts', shifts);
                const timeEntriesSuccess = saveDataToFirebase('timeEntries', timeEntries);
                
                if (!usersSuccess || !shiftsSuccess || !timeEntriesSuccess) {
                    console.warn("‚ö†Ô∏è Firebase Sync fehlgeschlagen, speichere lokal");
                    saveLocalData();
                }
            } else {
                console.log("üì± Speichere lokal (Offline-Modus)");
                saveLocalData();
            }
        }

        // ============================================
        // AUTHENTIFIZIERUNG
        // ============================================
        function handleLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            console.log("üîê Login versuch mit:", username);
            
            if (!username || !password) {
                showLoginError('Bitte Benutzername und Passwort eingeben');
                return;
            }
            
            // HAUPTPUNKT: Hauptadmin-Check
            if (username === MAIN_ADMIN.username && password === MAIN_ADMIN.password) {
                console.log("üëë Hauptadmin Login erkannt");
                
                let user = users.find(u => u.id === MAIN_ADMIN.id);
                
                if (!user) {
                    console.log("üìã Erstelle neuen Hauptadmin...");
                    user = {
                        id: MAIN_ADMIN.id,
                        name: MAIN_ADMIN.name,
                        username: MAIN_ADMIN.username,
                        password: MAIN_ADMIN.password,
                        role: MAIN_ADMIN.role,
                        regNumber: "ADMIN-001",
                        email: "marvin@vgf-service.de",
                        phone: "",
                        status: 'aktiv',
                        hours: 0,
                        overtime: 0,
                        pushNotification: true,
                        lastSeen: new Date().toLocaleString('de-DE'),
                        permissions: {
                            canManageShifts: true,
                            canManageEmployees: true,
                            canAssignShifts: true,
                            canViewAllShifts: true,
                            canEditOwnShifts: true,
                            canDeleteEverything: true,
                            isSuperAdmin: true
                        },
                        isMainAdmin: true,
                        createdAt: new Date().toISOString()
                    };
                    
                    users.push(user);
                    console.log("‚úÖ Hauptadmin erstellt");
                    saveData();
                } else {
                    console.log("‚úÖ Hauptadmin gefunden");
                    
                    user.permissions = {
                        canManageShifts: true,
                        canManageEmployees: true,
                        canAssignShifts: true,
                        canViewAllShifts: true,
                        canEditOwnShifts: true,
                        canDeleteEverything: true,
                        isSuperAdmin: true
                    };
                    user.isMainAdmin = true;
                    user.lastSeen = new Date().toLocaleString('de-DE');
                    
                    const userIndex = users.findIndex(u => u.id === MAIN_ADMIN.id);
                    if (userIndex !== -1) {
                        users[userIndex] = user;
                    }
                    
                    saveData();
                }
                
                currentUser = user;
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                initializeApp();
                
                showNotification(`üëë Willkommen Hauptadmin ${currentUser.name}!`, 'success');
                return;
            }
            
            // Normale Benutzer-Authentifizierung
            console.log("üë§ Suche normalen Benutzer...");
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                console.log("‚úÖ Benutzer gefunden:", user.name);
                currentUser = user;
                
                currentUser.lastSeen = new Date().toLocaleString('de-DE');
                
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                }
                
                saveData();
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                initializeApp();
                
                showNotification(`Willkommen, ${currentUser.name}!`, 'success');
            } else {
                showLoginError('Ung√ºltige Anmeldedaten');
            }
        }
        
        function handleLogout() {
            try {
                if (activeTimer) {
                    clearInterval(activeTimer);
                    activeTimer = null;
                }
                
                if (activeListeners.length > 0) {
                    activeListeners.forEach(ref => ref.off());
                    activeListeners = [];
                }
                
                currentUser = null;
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginError').style.display = 'none';
                
                showNotification('Erfolgreich abgemeldet', 'success');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Abmeldung fehlgeschlagen', 'error');
            }
        }

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        function isAdmin(user) {
            if (!user) return false;
            
            if (user.id === MAIN_ADMIN.id) return true;
            
            return user.role === 'admin' || user.role === 'kleinadmin' || 
                   (user.permissions && (user.permissions.canManageShifts || user.permissions.canManageEmployees));
        }
        
        function isMainAdmin(user) {
            return user && (user.id === MAIN_ADMIN.id || user.isMainAdmin === true);
        }
        
        function canConfirmAttendance(user) {
            if (!user) return false;
            
            if (isMainAdmin(user)) return true;
            
            return user.role === 'admin' || user.role === 'kleinadmin' || user.role === 'einsatzleiter';
        }
        
        function canManage(user) {
            if (!user) return false;
            
            if (isMainAdmin(user)) return true;
            
            return isAdmin(user) || (user.permissions && 
                   (user.permissions.canManageShifts || user.permissions.canManageEmployees));
        }

        function updateConnectionStatus(online, message) {
            const statusDiv = document.getElementById('connectionStatus');
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const onlineDot = document.getElementById('onlineDot');
            const onlineText = document.getElementById('onlineText');
            const syncIcon = document.getElementById('syncIcon');
            const syncText = document.getElementById('syncText');
            
            if (statusDiv && statusDot && statusText) {
                statusDiv.style.display = 'flex';
                statusDot.style.background = online ? '#10b981' : '#ef4444';
                statusText.textContent = message;
                statusDiv.style.background = online ? '#d1fae5' : '#fee2e2';
                statusDiv.style.color = online ? '#065f46' : '#991b1b';
            }
            
            if (onlineDot && onlineText) {
                onlineDot.style.background = online ? '#10b981' : '#ef4444';
                onlineText.textContent = online ? 'Online' : 'Offline';
                onlineText.style.color = online ? '#10b981' : '#ef4444';
            }
            
            if (syncIcon && syncText && document.getElementById('syncStatus')) {
                const syncStatus = document.getElementById('syncStatus');
                if (online) {
                    syncIcon.textContent = 'üîÑ';
                    syncText.textContent = 'Echtzeit';
                    syncStatus.style.background = '#d1fae5';
                    syncStatus.style.color = '#065f46';
                } else {
                    syncIcon.textContent = '‚ö†Ô∏è';
                    syncText.textContent = 'Offline';
                    syncStatus.style.background = '#fef3c7';
                    syncStatus.style.color = '#92400e';
                }
            }
        }
        
        function updateSyncStatus(syncing) {
            const syncIcon = document.getElementById('syncIcon');
            const syncText = document.getElementById('syncText');
            const syncStatus = document.getElementById('syncStatus');
            
            if (syncIcon && syncText && syncStatus) {
                if (syncing) {
                    syncIcon.textContent = 'üîÑ';
                    syncText.textContent = 'Sync...';
                    syncStatus.style.background = '#dbeafe';
                    syncStatus.style.color = '#1e40af';
                    
                    setTimeout(() => {
                        if (isOnline) {
                            syncIcon.textContent = '‚úÖ';
                            syncText.textContent = 'Echtzeit';
                            syncStatus.style.background = '#d1fae5';
                            syncStatus.style.color = '#065f46';
                        }
                    }, 2000);
                }
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
                display: flex;
                align-items: center;
                gap: 0.75rem;
                max-width: 400px;
            `;
            
            if (type === 'success') {
                notification.style.background = '#10b981';
                notification.style.color = 'white';
                notification.innerHTML = `‚úÖ ${message}`;
            } else if (type === 'error') {
                notification.style.background = '#ef4444';
                notification.style.color = 'white';
                notification.innerHTML = `‚ùå ${message}`;
            } else {
                notification.style.background = '#3b82f6';
                notification.style.color = 'white';
                notification.innerHTML = `‚ÑπÔ∏è ${message}`;
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transition = 'opacity 0.3s';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        // ============================================
        // APP FUNKTIONEN
        // ============================================
        function initializeApp() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.username;
            document.getElementById('userAvatar').textContent = getInitials(currentUser.name);
            
            // Hauptadmin-Styling
            if (isMainAdmin(currentUser)) {
                document.getElementById('userAvatar').style.background = '#ef4444';
            }
            
            const darkMode = localStorage.getItem('vgf_darkmode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
            }
            
            if (isOnline && !offlineMode && database) {
                setupFirebaseListeners();
            }
            
            if (!isAdmin(currentUser)) {
                markAllShiftsAsViewed();
                checkAndStartShiftTimer();
            }
            
            renderNavigation();
            
            if (isAdmin(currentUser)) {
                changeView('dashboard');
            } else {
                changeView('planning');
            }
        }
        
        function renderNavigation() {
            const nav = document.getElementById('navigation');
            if (!nav) return;
            
            const visibleItems = navigationItems.filter(item => {
                if (item.adminOnly && !isAdmin(currentUser)) {
                    return false;
                }
                return true;
            });
            
            nav.innerHTML = visibleItems.map(item => `
                <button class="nav-item ${item.id === currentView ? 'active' : ''}" onclick="changeView('${item.id}')">
                    ${getIcon(item.icon)}
                    <span>${item.label}</span>
                </button>
            `).join('');
        }
        
        function changeView(view) {
            currentView = view;
            const navItem = navigationItems.find(i => i.id === view);
            if (navItem) {
                document.getElementById('viewTitle').textContent = navItem.label;
            }
            renderNavigation();
            renderContent();
        }
        
        function updateCurrentDate() {
            const date = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = date.toLocaleDateString('de-DE', options);
        }
        
        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        // ============================================
        // RENDER FUNKTIONEN (Auszug - wichtigste)
        // ============================================
        function renderContent() {
            const content = document.getElementById('mainContent');
            
            switch(currentView) {
                case 'dashboard':
                    content.innerHTML = renderDashboard();
                    break;
                case 'planning':
                    content.innerHTML = renderPlanning();
                    break;
                case 'employees':
                    content.innerHTML = renderEmployees();
                    break;
                case 'timekeeping':
                    content.innerHTML = renderTimekeeping();
                    break;
                case 'control':
                    content.innerHTML = renderControlCenter();
                    break;
                case 'reports':
                    content.innerHTML = renderReports();
                    break;
                case 'settings':
                    content.innerHTML = renderSettings();
                    break;
            }
        }
        
        function renderDashboard() {
            const employees = users.filter(u => u.role !== 'admin');
            const activeEmployees = employees.filter(e => e.status === 'aktiv');
            const todayShifts = shifts.filter(s => s.date === selectedDate);
            const totalHours = employees.reduce((sum, e) => sum + (e.hours || 0), 0);
            const openShifts = shifts.filter(s => !s.employeeIds || s.employeeIds.length === 0).length;
            const pushEnabled = employees.filter(e => e.pushNotification).length;
            
            return `
                <div class="stats-grid">
                    <div class="stat-card green">
                        <div class="stat-icon">${getIcon('users')}</div>
                        <div class="stat-value">${activeEmployees.length}</div>
                        <div class="stat-label">Aktive Mitarbeiter</div>
                    </div>
                    <div class="stat-card emerald">
                        <div class="stat-icon">${getIcon('calendar')}</div>
                        <div class="stat-value">${todayShifts.length}</div>
                        <div class="stat-label">Heutige Schichten</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon">${getIcon('clock')}</div>
                        <div class="stat-value">${totalHours}</div>
                        <div class="stat-label">Gesamtstunden</div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-icon">${getIcon('alert')}</div>
                        <div class="stat-value">${openShifts}</div>
                        <div class="stat-label">Offene Schichten</div>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                ${getIcon('calendar')}
                                Heutige Schichten
                            </h3>
                        </div>
                        <div class="card-body">
                            ${todayShifts.length === 0 ? 
                                '<div class="empty-state"><p>Keine Schichten f√ºr heute</p></div>' :
                                todayShifts.map(shift => {
                                    const assignedEmployees = (shift.employeeIds || []).map(empId => users.find(u => u.id === empId)).filter(e => e);
                                    const viewedByUsers = (shift.viewedBy || []).map(userId => {
                                        const user = users.find(u => u.id === userId);
                                        return user ? user.name : 'Unbekannt';
                                    });
                                    
                                    return `
                                        <div class="employee-item" style="display: block; padding: 1rem;">
                                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                                                <div style="font-size: 1.5rem;">üìç</div>
                                                <div style="flex: 1;">
                                                    <div class="employee-name">${shift.location}</div>
                                                    <div class="employee-meta">${shift.time} ‚Ä¢ ${shift.type}</div>
                                                </div>
                                            </div>
                                            ${assignedEmployees.length > 0 ? `
                                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                                                    ${assignedEmployees.map(emp => `
                                                        <div style="display: flex; align-items: center; gap: 0.5rem; background: var(--bg-tertiary); padding: 0.5rem 0.75rem; border-radius: 0.5rem;">
                                                            <div style="width: 24px; height: 24px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.625rem;">
                                                                ${getInitials(emp.name)}
                                                            </div>
                                                            <span style="font-size: 0.875rem;">${emp.name}</span>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            ` : `
                                                <div style="padding: 0.5rem; background: #fef3c7; border-left: 3px solid #f59e0b; border-radius: 0.25rem; font-size: 0.875rem; color: #92400e;">
                                                    ‚ö†Ô∏è Keine Mitarbeiter zugewiesen
                                                </div>
                                            `}
                                            ${viewedByUsers.length > 0 && (currentUser.permissions?.canViewAllShifts || currentUser.role === 'admin') ? `
                                                <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.5rem;">
                                                    üëÅÔ∏è ${viewedByUsers.length} gesehen
                                                </div>
                                            ` : ''}
                                        </div>
                                    `;
                                }).join('')
                            }
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                ${getIcon('bell')}
                                Push-Benachrichtigungen
                            </h3>
                        </div>
                        <div class="card-body">
                            <div style="background: #d1fae5; padding: 1.25rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        ${getIcon('check')}
                                        <div>
                                            <div style="font-weight: 600; color: #065f46;">Aktiviert</div>
                                            <div style="font-size: 0.875rem; color: #059669;">${pushEnabled} Mitarbeiter</div>
                                        </div>
                                    </div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #059669;">${pushEnabled}</div>
                                </div>
                            </div>
                            <div style="background: #f3f4f6; padding: 1.25rem; border-radius: 0.5rem;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        ${getIcon('alert')}
                                        <div>
                                            <div style="font-weight: 600; color: #374151;">Deaktiviert</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">${employees.length - pushEnabled} Mitarbeiter</div>
                                        </div>
                                    </div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #9ca3af;">${employees.length - pushEnabled}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            ${getIcon('users')}
                            Mitarbeiter-√úbersicht
                        </h3>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Rolle</th>
                                    <th>Status</th>
                                    <th style="text-align: right;">Stunden</th>
                                    <th style="text-align: right;">√úberstunden</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${employees.slice(0, 5).map(emp => `
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <div style="width: 32px; height: 32px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.875rem;">
                                                    ${getInitials(emp.name)}
                                                </div>
                                                ${emp.name}
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge badge-${getRoleBadgeColor(emp.role)}">
                                                ${ROLES[emp.role]?.label || emp.role}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge badge-${emp.status === 'aktiv' ? 'green' : 'red'}">
                                                ${emp.status}
                                            </span>
                                        </td>
                                        <td style="text-align: right;">${emp.hours || 0}h</td>
                                        <td style="text-align: right;">
                                            <span class="${emp.overtime > 0 ? 'text-positive' : emp.overtime < 0 ? 'text-negative' : ''}">
                                                ${emp.overtime > 0 ? '+' : ''}${emp.overtime || 0}h
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function renderPlanning() {
            const userIsAdmin = isAdmin(currentUser);
            const isCurrentUserAssigned = (shift) => (shift.employeeIds || []).includes(currentUser.id);
            
            return `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.25rem;">
                            ${userIsAdmin ? 'Schichtplanung' : 'Verf√ºgbare Schichten'}
                        </h3>
                        <p style="color: #6b7280;">
                            ${userIsAdmin ? 'Verwalten Sie alle Schichten - Mehrfach-Zuweisung m√∂glich' : 'Tragen Sie sich f√ºr verf√ºgbare Schichten ein'}
                        </p>
                    </div>
                    ${userIsAdmin ? `
                        <button class="btn-primary" onclick="showAddShiftModal()">
                            ${getIcon('plus')}
                            Neue Schicht
                        </button>
                    ` : ''}
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div style="display: flex; gap: 1rem;">
                            <input type="date" value="${selectedDate}" onchange="selectedDate = this.value; renderContent()" 
                                   style="padding: 0.5rem 1rem; border: 2px solid var(--border-color); border-radius: 0.5rem; background: var(--bg-primary); color: var(--text-primary);">
                        </div>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        ${shifts.length === 0 ? 
                            '<div class="empty-state"><div class="empty-icon">${getIcon("calendar")}</div><div class="empty-title">Keine Schichten vorhanden</div></div>' :
                            shifts.map(shift => {
                                const assignedEmployees = (shift.employeeIds || []).map(empId => users.find(u => u.id === empId)).filter(e => e);
                                const userAssigned = isCurrentUserAssigned(shift);
                                const viewedByUsers = (shift.viewedBy || []).map(userId => {
                                    const user = users.find(u => u.id === userId);
                                    return user ? user.name : 'Unbekannt';
                                });
                                
                                return `
                                    <div class="employee-item">
                                        <div class="employee-left" style="flex: 1;">
                                            <div style="display: flex; align-items: start; gap: 1rem; width: 100%;">
                                                <div style="font-size: 2rem;">üìç</div>
                                                <div class="employee-details" style="flex: 1;">
                                                    <div class="employee-name" style="font-size: 1.125rem;">
                                                        ${shift.location}
                                                        <span class="badge badge-blue" style="margin-left: 0.5rem;">
                                                            ${shift.type}
                                                        </span>
                                                    </div>
                                                    <div class="employee-meta" style="margin-top: 0.5rem;">
                                                        üìÖ ${new Date(shift.date).toLocaleDateString('de-DE')} ‚Ä¢ ‚è∞ ${shift.time}
                                                        ${shift.breakMinutes ? ` ‚Ä¢ ‚òï ${shift.breakMinutes} Min Pause` : ''}
                                                    </div>
                                                    
                                                    ${assignedEmployees.length > 0 ? `
                                                        <div style="margin-top: 0.75rem;">
                                                            <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                                                üë• Zugewiesen (${assignedEmployees.length}):
                                                            </div>
                                                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                                                ${assignedEmployees.map(emp => `
                                                                    <div style="display: flex; align-items: center; gap: 0.5rem; background: var(--bg-tertiary); padding: 0.5rem 0.75rem; border-radius: 0.5rem;">
                                                                        <div style="width: 28px; height: 28px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.75rem;">
                                                                            ${getInitials(emp.name)}
                                                                        </div>
                                                                        <span style="font-size: 0.875rem; color: var(--text-primary);">${emp.name}</span>
                                                                        ${userIsAdmin ? `
                                                                            <button type="button" onclick="removeEmployeeFromShift('${shift.id}', '${emp.id}'); return false;" 
                                                                                    style="background: #fee2e2; border: none; color: #dc2626; cursor: pointer; padding: 0.25rem 0.5rem; font-size: 1.25rem; font-weight: 700; border-radius: 0.375rem; line-height: 1; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;"
                                                                                    onmouseover="this.style.background='#fca5a5'; this.style.transform='scale(1.1)'"
                                                                                    onmouseout="this.style.background='#fee2e2'; this.style.transform='scale(1)'"
                                                                                    title="Mitarbeiter entfernen">√ó</button>
                                                                        ` : ''}
                                                                    </div>
                                                                `).join('')}
                                                            </div>
                                                        </div>
                                                    ` : `
                                                        <div style="margin-top: 0.75rem; padding: 0.75rem; background: #fef3c7; border-left: 3px solid #f59e0b; border-radius: 0.25rem;">
                                                            <span style="color: #92400e; font-size: 0.875rem;">‚ö†Ô∏è Noch keine Mitarbeiter zugewiesen</span>
                                                        </div>
                                                    `}
                                                    
                                                    ${viewedByUsers.length > 0 && isAdmin(currentUser) ? `
                                                        <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.5rem;">
                                                            üëÅÔ∏è Gesehen von: ${viewedByUsers.join(', ')}
                                                        </div>
                                                    ` : ''}
                                                    
                                                    ${canConfirmAttendance(currentUser) && assignedEmployees.length > 0 ? `
                                                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                                                            <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                                                üìã Anwesenheitsliste
                                                                ${shift.completed ? '<span style="color: #10b981; font-size: 0.75rem;">‚úì Abgeschlossen</span>' : ''}
                                                            </div>
                                                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                                                ${assignedEmployees.map(emp => {
                                                                    const attendance = shift.attendance?.[emp.id];
                                                                    const timeEntry = timeEntries.find(e => 
                                                                        e.userId === emp.id && 
                                                                        e.date === shift.date && 
                                                                        e.endTime
                                                                    );
                                                                    const workedHours = timeEntry ? 
                                                                        formatDuration(new Date(timeEntry.endTime).getTime() - new Date(timeEntry.startTime).getTime() - (timeEntry.pauseDuration || 0)) : 
                                                                        'Nicht erfasst';
                                                                    
                                                                    return `
                                                                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; background: ${attendance?.present ? '#d1fae5' : 'var(--bg-tertiary)'}; border-radius: 0.5rem; border: 2px solid ${attendance?.present ? '#10b981' : 'transparent'};">
                                                                            <div style="display: flex; align-items: center; gap: 0.75rem; flex: 1;">
                                                                                <div style="width: 32px; height: 32px; background: ${attendance?.present ? '#10b981' : '#6b7280'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.875rem;">
                                                                                    ${attendance?.present ? '‚úì' : getInitials(emp.name)}
                                                                                </div>
                                                                                <div style="flex: 1;">
                                                                                    <div style="font-weight: 600; color: var(--text-primary);">${emp.name}</div>
                                                                                    ${attendance?.present ? `
                                                                                        <div style="font-size: 0.75rem; color: #059669;">
                                                                                            ‚è±Ô∏è ${workedHours}
                                                                                            ${attendance.confirmedBy ? ` ‚Ä¢ Best√§tigt von ${users.find(u => u.id === attendance.confirmedBy)?.name}` : ''}
                                                                                        </div>
                                                                                    ` : `
                                                                                        <div style="font-size: 0.75rem; color: #6b7280;">Nicht anwesend</div>
                                                                                    `}
                                                                                </div>
                                                                            </div>
                                                                            ${!shift.completed ? `
                                                                                <button class="btn-icon" style="background: ${attendance?.present ? '#fee2e2' : '#d1fae5'}; color: ${attendance?.present ? '#dc2626' : '#065f46'};" 
                                                                                        onclick="toggleAttendance('${shift.id}', '${emp.id}')" 
                                                                                        title="${attendance?.present ? 'Als abwesend markieren' : 'Als anwesend best√§tigen'}">
                                                                                    ${attendance?.present ? '‚úó' : '‚úì'}
                                                                                </button>
                                                                            ` : ''}
                                                                        </div>
                                                                    `;
                                                                }).join('')}
                                                            </div>
                                                            ${!shift.completed ? `
                                                                <button class="btn-primary" style="width: 100%; margin-top: 0.75rem; padding: 0.75rem; font-size: 0.875rem;" onclick="completeShift('${shift.id}')">
                                                                    üîí Schicht abschlie√üen
                                                                </button>
                                                            ` : ''}
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="employee-actions" style="flex-shrink: 0;">
                                            ${userIsAdmin ? `
                                                <button class="btn-icon" style="background: #d1fae5; color: #065f46;" onclick="addEmployeeToShift('${shift.id}')" title="Mitarbeiter hinzuf√ºgen">
                                                    ${getIcon('plus')}
                                                </button>
                                                <button class="btn-icon edit" onclick="editShift('${shift.id}')">
                                                    ${getIcon('edit')}
                                                </button>
                                                <button class="btn-icon delete" onclick="deleteShift('${shift.id}')">
                                                    ${getIcon('trash')}
                                                </button>
                                            ` : `
                                                ${userAssigned ? `
                                                    <button class="btn-icon delete" onclick="removeEmployeeFromShift('${shift.id}', '${currentUser.id}')" title="Austragen">
                                                        ${getIcon('trash')}
                                                    </button>
                                                ` : `
                                                    <button class="btn-icon" style="background: #d1fae5; color: #065f46;" onclick="addMyselfToShift('${shift.id}')" title="Eintragen">
                                                        ${getIcon('plus')}
                                                    </button>
                                                `}
                                            `}
                                        </div>
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>
                </div>
            `;
        }
        
        function renderEmployees() {
            const employees = users.filter(u => u.role !== 'admin');
            
            return `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.25rem;">Mitarbeiter</h3>
                        <p style="color: #6b7280;">${employees.length} Mitarbeiter im System</p>
                    </div>
                    <button class="btn-primary" onclick="showAddEmployeeModal()">
                        ${getIcon('plus')}
                        Neuer Mitarbeiter
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="search-wrapper">
                            <span class="search-icon">${getIcon('search')}</span>
                            <input type="text" class="search-input" placeholder="Mitarbeiter suchen..." onkeyup="searchEmployees(this.value)">
                        </div>
                    </div>
                    <div class="card-body" style="padding: 0;" id="employeeList">
                        ${employees.length === 0 ? 
                            '<div class="empty-state"><div class="empty-icon">${getIcon("users")}</div><div class="empty-title">Keine Mitarbeiter gefunden</div></div>' :
                            employees.map(emp => {
                                const empShifts = shifts.filter(s => s.employeeId === emp.id);
                                const perms = [];
                                if (emp.permissions) {
                                    if (emp.permissions.canManageShifts) perms.push('Schichten verwalten');
                                    if (emp.permissions.canManageEmployees) perms.push('Personal');
                                    if (emp.permissions.canAssignShifts) perms.push('Zuweisung');
                                }
                                
                                return `
                                    <div class="employee-item">
                                        <div class="employee-left">
                                            <div class="employee-avatar-large">${getInitials(emp.name)}</div>
                                            <div class="employee-details">
                                                <div class="employee-name">
                                                    ${emp.name}
                                                    <span class="badge badge-${getRoleBadgeColor(emp.role)}">
                                                        ${ROLES[emp.role]?.label || emp.role}
                                                    </span>
                                                </div>
                                                <div class="employee-meta">
                                                    ${emp.regNumber || emp.username} ‚Ä¢ ${empShifts.length} Schichten
                                                </div>
                                                ${perms.length > 0 ? `
                                                    <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.25rem;">
                                                        üîë ${perms.join(', ')}
                                                    </div>
                                                ` : ''}
                                                ${emp.email ? `
                                                    <div style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.25rem; display: flex; align-items: center; gap: 0.25rem;">
                                                        ${getIcon('mail')}
                                                        ${emp.email}
                                                    </div>
                                                ` : ''}
                                            </div>
                                        </div>
                                        <div class="employee-actions">
                                            <button class="btn-icon edit" onclick="editEmployee('${emp.id}')">
                                                ${getIcon('edit')}
                                            </button>
                                            <button class="btn-icon delete" onclick="deleteEmployee('${emp.id}')">
                                                ${getIcon('trash')}
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>
                </div>
                
                ${users.filter(u => u.role === 'admin').length > 0 ? `
                    <div class="card" style="margin-top: 1.5rem;">
                        <div class="card-header">
                            <h4 style="font-weight: 600;">Administratoren</h4>
                        </div>
                        <div class="card-body" style="padding: 0;">
                            ${users.filter(u => u.role === 'admin').map(admin => `
                                <div class="employee-item">
                                    <div class="employee-left">
                                        <div class="employee-avatar-large" style="background: #ef4444;">${getInitials(admin.name)}</div>
                                        <div class="employee-details">
                                            <div class="employee-name">
                                                ${admin.name}
                                                <span class="badge badge-red">Administrator</span>
                                            </div>
                                            <div class="employee-meta">${admin.username}</div>
                                            <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.25rem;">
                                                üîë Voller Zugriff
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }
        
        function renderTimekeeping() {
            if (isAdmin(currentUser)) {
                return renderTimekeepingAdmin();
            } else {
                return renderTimekeepingEmployee();
            }
        }
        
        function renderTimekeepingEmployee() {
            const today = new Date().toISOString().split('T')[0];
            const todayEntries = timeEntries.filter(e => e.userId === currentUser.id && e.date === today);
            const currentEntry = todayEntries.find(e => !e.endTime);
            
            const allUserEntries = timeEntries.filter(e => e.userId === currentUser.id);
            const weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const weekEntries = allUserEntries.filter(e => {
                const entryDate = new Date(e.date);
                return entryDate >= weekStart && entryDate <= weekEnd;
            });
            
            const weekHours = calculateTotalHours(weekEntries);
            const monthStart = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
            const monthEntries = allUserEntries.filter(e => e.date >= monthStart);
            const monthHours = calculateTotalHours(monthEntries);
            
            return `
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.25rem;">Meine Zeiterfassung</h3>
                    <p style="color: #6b7280;">Verwalten Sie Ihre Arbeitszeiten</p>
                </div>
                
                <div class="stats-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card green">
                        <div class="stat-icon">${getIcon('clock')}</div>
                        <div class="stat-value">${calculateTodayHours(todayEntries)}</div>
                        <div class="stat-label">Heute</div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-icon">${getIcon('calendar')}</div>
                        <div class="stat-value">${weekHours}</div>
                        <div class="stat-label">Diese Woche</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon">${getIcon('chart')}</div>
                        <div class="stat-value">${monthHours}</div>
                        <div class="stat-label">Dieser Monat</div>
                    </div>
                    <div class="stat-card ${currentEntry ? 'emerald' : 'gray'}">
                        <div class="stat-icon">${currentEntry ? '‚è±Ô∏è' : '‚èπÔ∏è'}</div>
                        <div class="stat-value" id="liveTimer">
                            ${currentEntry ? formatDuration(Date.now() - new Date(currentEntry.startTime).getTime()) : '--:--'}
                        </div>
                        <div class="stat-label">${currentEntry ? 'L√§uft seit Start' : 'Gestoppt'}</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            ${getIcon('clock')}
                            Stempeluhr
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="text-align: center; padding: 2rem;">
                            <div style="font-size: 3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;" id="currentTime">
                                ${new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}
                            </div>
                            <div style="font-size: 1.125rem; color: var(--text-secondary); margin-bottom: 2rem;">
                                ${new Date().toLocaleDateString('de-DE', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' })}
                            </div>
                            
                            ${currentEntry ? `
                                <div style="background: #d1fae5; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem;">
                                    <div style="font-size: 0.875rem; color: #065f46; margin-bottom: 0.5rem;">Gestartet um ${new Date(currentEntry.startTime).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}</div>
                                    <div style="font-size: 2rem; font-weight: 700; color: #059669; margin-bottom: 0.75rem;" id="runningTimer">
                                        ${formatDuration(Date.now() - new Date(currentEntry.startTime).getTime())}
                                    </div>
                                    <div style="background: #dcfce7; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.75rem;">
                                        <div style="color: #166534; font-size: 0.875rem; font-weight: 600;">
                                            ‚è±Ô∏è ARBEITSZEIT L√ÑUFT
                                        </div>
                                        <div style="color: #15803d; font-size: 0.75rem; margin-top: 0.25rem;">
                                            Pausenzeit wird automatisch abgezogen
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="max-width: 300px; margin: 0 auto;">
                                    <button class="btn-danger" style="width: 100%; padding: 1rem; font-weight: 600; font-size: 1.125rem;" onclick="stopTimer()">
                                        ‚èπÔ∏è Arbeit beenden
                                    </button>
                                </div>
                            ` : `
                                <button class="btn-primary" style="font-size: 1.125rem; padding: 1.25rem 2rem; max-width: 300px; margin: 0 auto; font-weight: 600;" onclick="startTimer()">
                                    ‚ñ∂Ô∏è Arbeit starten
                                </button>
                            `}
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            ${getIcon('calendar')}
                            Heutige Eintr√§ge
                        </h3>
                    </div>
                    <div class="card-body">
                        ${todayEntries.length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-icon">${getIcon('clock')}</div>
                                <div class="empty-title">Keine Eintr√§ge f√ºr heute</div>
                            </div>
                        ` : `
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Start</th>
                                        <th>Ende</th>
                                        <th>Pause</th>
                                        <th style="text-align: right;">Dauer</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${todayEntries.map(entry => {
                                        const userShift = shifts.find(s => 
                                            s.date === entry.date && 
                                            (s.employeeIds || []).includes(currentUser.id)
                                        );
                                        const approvedBreak = (userShift?.breakMinutes || 0) * 60 * 1000;
                                        
                                        return `
                                        <tr>
                                            <td>${new Date(entry.startTime).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}</td>
                                            <td>${entry.endTime ? new Date(entry.endTime).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }) : '<span style="color: #10b981;">L√§uft...</span>'}</td>
                                            <td>${approvedBreak > 0 ? formatDuration(approvedBreak) + ' <span style="color: #10b981; font-size: 0.75rem;">‚úì</span>' : '-'}</td>
                                            <td style="text-align: right; font-weight: 600;">
                                                ${entry.endTime ? formatDuration(new Date(entry.endTime).getTime() - new Date(entry.startTime).getTime() - approvedBreak) : formatDuration(Date.now() - new Date(entry.startTime).getTime())}
                                            </td>
                                        </tr>
                                    `}).join('')}
                                </tbody>
                            </table>
                        `}
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            üìä Wochen√ºbersicht
                        </h3>
                    </div>
                    <div class="card-body">
                        ${renderWeekOverview()}
                    </div>
                </div>
            `;
        }
        
        function renderWeekOverview() {
            const weekDays = [];
            const today = new Date();
            const currentDay = today.getDay();
            const monday = new Date(today);
            monday.setDate(today.getDate() - (currentDay === 0 ? 6 : currentDay - 1));
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(monday);
                day.setDate(monday.getDate() + i);
                const dateStr = day.toISOString().split('T')[0];
                const dayEntries = timeEntries.filter(e => e.userId === currentUser.id && e.date === dateStr);
                const hours = calculateTotalHours(dayEntries);
                
                weekDays.push({
                    date: dateStr,
                    dayName: day.toLocaleDateString('de-DE', { weekday: 'short' }),
                    dayNum: day.getDate(),
                    hours: hours,
                    isToday: dateStr === new Date().toISOString().split('T')[0]
                });
            }
            
            return `
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem;">
                    ${weekDays.map(day => `
                        <div style="text-align: center; padding: 1rem; background: ${day.isToday ? '#d1fae5' : 'var(--bg-tertiary)'}; border-radius: 0.5rem;">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">${day.dayName}</div>
                            <div style="font-size: 1.125rem; font-weight: 700; color: ${day.isToday ? '#059669' : 'var(--text-primary)'}; margin-bottom: 0.25rem;">${day.dayNum}</div>
                            <div style="font-size: 0.875rem; font-weight: 600; color: ${day.hours === '0:00' ? 'var(--text-tertiary)' : '#10b981'};">
                                ${day.hours}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function calculateTodayHours(entries) {
            return calculateTotalHours(entries);
        }
        
        function calculateTotalHours(entries) {
            let totalMs = 0;
            entries.forEach(entry => {
                if (entry.endTime) {
                    totalMs += new Date(entry.endTime).getTime() - new Date(entry.startTime).getTime() - (entry.pauseDuration || 0);
                } else {
                    totalMs += Date.now() - new Date(entry.startTime).getTime() - (entry.pauseDuration || 0);
                }
            });
            return formatDuration(totalMs);
        }
        
        function formatDuration(ms) {
            const hours = Math.floor(ms / (1000 * 60 * 60));
            const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
            return `${hours}:${minutes.toString().padStart(2, '0')}`;
        }
        
        function startTimer() {
            const now = new Date();
            const entry = {
                id: Date.now().toString(),
                userId: currentUser.id,
                date: now.toISOString().split('T')[0],
                startTime: now.toISOString(),
                endTime: null,
                pauseDuration: 0,
                pauseStart: null
            };
            
            timeEntries.push(entry);
            saveData();
            renderContent();
            startLiveTimer();
        }
        
        function stopTimer() {
            const entry = timeEntries.find(e => e.userId === currentUser.id && !e.endTime);
            if (entry) {
                entry.endTime = new Date().toISOString();
                
                const today = entry.date;
                const userShift = shifts.find(s => 
                    s.date === today && 
                    (s.employeeIds || []).includes(currentUser.id)
                );
                
                if (userShift && userShift.breakMinutes) {
                    entry.pauseDuration = userShift.breakMinutes * 60 * 1000;
                } else {
                    entry.pauseDuration = 0;
                }
                
                entry.pauseStart = null;
                
                saveData();
                renderContent();
                stopLiveTimer();
                
                const workTime = new Date(entry.endTime).getTime() - new Date(entry.startTime).getTime() - entry.pauseDuration;
                alert(`‚úÖ Arbeitszeit beendet!\n\nGesamtzeit: ${formatDuration(new Date(entry.endTime).getTime() - new Date(entry.startTime).getTime())}\nPausenzeit: ${formatDuration(entry.pauseDuration)}\nArbeitszeit: ${formatDuration(workTime)}`);
            }
        }
        
        function startLiveTimer() {
            stopLiveTimer();
            updateLiveTimers();
            activeTimer = setInterval(updateLiveTimers, 1000);
        }
        
        function stopLiveTimer() {
            if (activeTimer) {
                clearInterval(activeTimer);
                activeTimer = null;
            }
        }
        
        function updateLiveTimers() {
            const currentTimeEl = document.getElementById('currentTime');
            if (currentTimeEl) {
                currentTimeEl.textContent = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            }
            
            const entry = timeEntries.find(e => e.userId === currentUser.id && !e.endTime);
            if (entry) {
                const runningTimerEl = document.getElementById('runningTimer');
                const liveTimerEl = document.getElementById('liveTimer');
                
                const totalElapsed = Date.now() - new Date(entry.startTime).getTime();
                
                if (runningTimerEl) {
                    runningTimerEl.textContent = formatDuration(totalElapsed);
                }
                if (liveTimerEl) {
                    liveTimerEl.textContent = formatDuration(totalElapsed);
                }
            }
        }
        
        function renderTimekeepingAdmin() {
            const today = new Date().toISOString().split('T')[0];
            const allEmployees = users.filter(u => !isAdmin(u));
            const todayAllEntries = timeEntries.filter(e => e.date === today);
            const activeTimers = timeEntries.filter(e => !e.endTime);
            
            return `
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.25rem;">Zeiterfassung - √úbersicht</h3>
                    <p style="color: #6b7280;">Alle Mitarbeiter-Arbeitszeiten im √úberblick</p>
                </div>
                
                <div class="stats-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card green">
                        <div class="stat-icon">${getIcon('users')}</div>
                        <div class="stat-value">${allEmployees.length}</div>
                        <div class="stat-label">Mitarbeiter</div>
                    </div>
                    <div class="stat-card emerald">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-value">${activeTimers.length}</div>
                        <div class="stat-label">Aktive Timer</div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-icon">${getIcon('calendar')}</div>
                        <div class="stat-value">${todayAllEntries.length}</div>
                        <div class="stat-label">Eintr√§ge Heute</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon">${getIcon('clock')}</div>
                        <div class="stat-value">${calculateTotalHours(todayAllEntries)}</div>
                        <div class="stat-label">Stunden Heute</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            ${getIcon('users')}
                            Mitarbeiter Arbeitszeiten
                        </h3>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Mitarbeiter</th>
                                    <th>Status</th>
                                    <th>Heute</th>
                                    <th>Diese Woche</th>
                                    <th>Dieser Monat</th>
                                    <th>Laufzeit</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allEmployees.map(emp => {
                                    const empEntries = timeEntries.filter(e => e.userId === emp.id);
                                    const empTodayEntries = empEntries.filter(e => e.date === today);
                                    const activeEntry = empEntries.find(e => !e.endTime);
                                    
                                    const weekStart = new Date();
                                    weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1);
                                    const weekEnd = new Date(weekStart);
                                    weekEnd.setDate(weekEnd.getDate() + 6);
                                    const weekEntries = empEntries.filter(e => {
                                        const entryDate = new Date(e.date);
                                        return entryDate >= weekStart && entryDate <= weekEnd;
                                    });
                                    
                                    const monthStart = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
                                    const monthEntries = empEntries.filter(e => e.date >= monthStart);
                                    
                                    return `
                                        <tr>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                    <div style="width: 32px; height: 32px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.875rem;">
                                                        ${getInitials(emp.name)}
                                                    </div>
                                                    <div>
                                                        <div style="font-weight: 600;">${emp.name}</div>
                                                        <div style="font-size: 0.75rem; color: #6b7280;">${ROLES[emp.role]?.label}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                ${activeEntry ? `
                                                    <span class="badge badge-green">‚è±Ô∏è L√§uft</span>
                                                ` : `
                                                    <span class="badge badge-gray">‚è∏Ô∏è Gestoppt</span>
                                                `}
                                            </td>
                                            <td>${calculateTodayHours(empTodayEntries)}</td>
                                            <td>${calculateTotalHours(weekEntries)}</td>
                                            <td>${calculateTotalHours(monthEntries)}</td>
                                            <td>
                                                ${activeEntry ? `
                                                    <span style="color: #10b981; font-weight: 600;">
                                                        ${formatDuration(Date.now() - new Date(activeEntry.startTime).getTime())}
                                                    </span>
                                                ` : '--:--'}
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            ${getIcon('calendar')}
                            Heutige Zeiteintr√§ge - Alle Mitarbeiter
                        </h3>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        ${todayAllEntries.length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-icon">${getIcon('clock')}</div>
                                <div class="empty-title">Keine Eintr√§ge heute</div>
                            </div>
                        ` : `
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Mitarbeiter</th>
                                        <th>Start</th>
                                        <th>Ende</th>
                                        <th>Pause</th>
                                        <th>Dauer</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${todayAllEntries.map(entry => {
                                        const employee = users.find(u => u.id === entry.userId);
                                        const userShift = shifts.find(s => 
                                            s.date === entry.date && 
                                            (s.employeeIds || []).includes(entry.userId)
                                        );
                                        const approvedBreak = (userShift?.breakMinutes || 0) * 60 * 1000;
                                        
                                        const duration = entry.endTime ? 
                                            new Date(entry.endTime) - new Date(entry.startTime) - approvedBreak :
                                            Date.now() - new Date(entry.startTime).getTime();
                                        
                                        return `
                                            <tr>
                                                <td>
                                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                        <div style="width: 28px; height: 28px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.75rem;">
                                                            ${getInitials(employee?.name || 'Unknown')}
                                                        </div>
                                                        ${employee?.name || 'Unbekannt'}
                                                    </div>
                                                </td>
                                                <td>${new Date(entry.startTime).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}</td>
                                                <td>${entry.endTime ? new Date(entry.endTime).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }) : '<span style="color: #10b981;">L√§uft...</span>'}</td>
                                                <td>${approvedBreak > 0 ? formatDuration(approvedBreak) + ' <span style="color: #10b981; font-size: 0.75rem;">‚úì</span>' : '-'}</td>
                                                <td><strong>${formatDuration(duration)}</strong></td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        `}
                    </div>
                </div>
            `;
        }
        
        function renderControlCenter() {
            const activeShifts = shifts.filter(s => s.date === new Date().toISOString().split('T')[0] && s.employeeId);
            const allEmployees = users.filter(u => u.role !== 'admin');
            const onDuty = activeShifts.length;
            const available = allEmployees.filter(e => e.status === 'aktiv').length - onDuty;
            
            return `
                <div class="stats-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card green">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-value">${onDuty}</div>
                        <div class="stat-label">Im Einsatz</div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value">${available}</div>
                        <div class="stat-label">Verf√ºgbar</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Alarme</div>
                    </div>
                    <div class="stat-card emerald">
                        <div class="stat-icon">üìç</div>
                        <div class="stat-value">${shifts.length}</div>
                        <div class="stat-label">Standorte</div>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                üìç Live-Einsatz√ºbersicht
                            </h3>
                        </div>
                        <div class="card-body">
                            ${activeShifts.length === 0 ? `
                                <div class="empty-state">
                                    <div class="empty-icon">${getIcon('map')}</div>
                                    <div class="empty-title">Keine aktiven Eins√§tze</div>
                                </div>
                            ` : activeShifts.map(shift => {
                                const employee = users.find(u => u.id === shift.employeeId);
                                const status = Math.random() > 0.5 ? 'Aktiv' : 'Pause';
                                const statusColor = status === 'Aktiv' ? '#10b981' : '#f59e0b';
                                
                                return `
                                    <div class="employee-item">
                                        <div class="employee-left">
                                            <div class="employee-avatar-large" style="background: ${statusColor};">
                                                ${getInitials(employee?.name || 'UN')}
                                            </div>
                                            <div class="employee-details">
                                                <div class="employee-name">
                                                    ${employee?.name || 'Unbekannt'}
                                                    <span class="badge badge-${status === 'Aktiv' ? 'green' : 'gray'}" style="background: ${statusColor}22; color: ${statusColor};">
                                                        ‚óè ${status}
                                                    </span>
                                                </div>
                                                <div class="employee-meta">
                                                    üìç ${shift.location}
                                                </div>
                                                <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 0.25rem;">
                                                    ‚è∞ ${shift.time} ‚Ä¢ ${shift.type}
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <button class="btn-icon edit" style="background: #dbeafe; color: #1e40af;" onclick="alert('GPS-Tracking: ${shift.location}')">
                                                üìç
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                üö® Einsatz-Log
                            </h3>
                        </div>
                        <div class="card-body">
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${generateEventLog()}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            üó∫Ô∏è Standortkarte
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="background: var(--bg-tertiary); padding: 3rem; border-radius: 0.75rem; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">üó∫Ô∏è</div>
                            <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">Interaktive Karte</h4>
                            <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1.5rem;">
                                Zeigt alle aktiven Einsatzorte in Echtzeit
                            </p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; text-align: left;">
                                ${shifts.map(shift => `
                                    <div style="background: var(--bg-primary); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #10b981;">
                                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">
                                            üìç ${shift.location}
                                        </div>
                                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                            ${users.find(u => u.id === shift.employeeId)?.name || 'Nicht zugewiesen'}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateEventLog() {
            const events = [
                { time: '14:32', type: 'info', message: 'Schichtwechsel abgeschlossen', icon: '‚úÖ' },
                { time: '14:15', type: 'warning', message: 'Mitarbeiter meldet Pause', icon: '‚è∏Ô∏è' },
                { time: '13:58', type: 'success', message: 'Neue Schicht gestartet', icon: '‚ñ∂Ô∏è' },
                { time: '13:45', type: 'info', message: 'Standort-Update empfangen', icon: 'üìç' },
                { time: '13:30', type: 'warning', message: 'Versp√§tete Schicht√ºbernahme', icon: '‚ö†Ô∏è' },
                { time: '13:15', type: 'success', message: 'Alle Positionen besetzt', icon: '‚úÖ' },
                { time: '13:00', type: 'info', message: 'Tagesschicht begonnen', icon: 'üåÖ' },
                { time: '12:45', type: 'info', message: 'System-Check erfolgreich', icon: 'üîß' }
            ];
            
            return events.map(event => `
                <div style="display: flex; align-items: start; gap: 1rem; padding: 0.75rem; border-bottom: 1px solid var(--border-color-light);">
                    <div style="font-size: 1.5rem;">${event.icon}</div>
                    <div style="flex: 1;">
                        <div style="font-size: 0.875rem; color: var(--text-primary); font-weight: 500;">
                            ${event.message}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 0.25rem;">
                            ${event.time} Uhr
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderReports() {
            const allEmployees = users.filter(u => !isAdmin(u));
            const totalHours = timeEntries.reduce((sum, e) => {
                if (e.endTime) {
                    return sum + (new Date(e.endTime).getTime() - new Date(e.startTime).getTime() - (e.pauseDuration || 0));
                }
                return sum;
            }, 0) / (1000 * 60 * 60);
            
            const totalShifts = shifts.length;
            const completedShifts = shifts.filter(s => s.completed).length;
            const totalConfirmedAttendance = shifts.reduce((sum, s) => sum + Object.keys(s.attendance || {}).length, 0);
            
            return `
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="font-size: 1.25rem; font-weight: 600;">Berichte & Einsatzdokumentation</h3>
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">Abgeschlossene Schichten und Anwesenheitslisten</p>
                        </div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card green">
                        <div class="stat-icon">${getIcon('clock')}</div>
                        <div class="stat-value">${Math.round(totalHours)}</div>
                        <div class="stat-label">Gesamt-Stunden</div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-icon">${getIcon('calendar')}</div>
                        <div class="stat-value">${completedShifts}</div>
                        <div class="stat-label">Abgeschlossene Schichten</div>
                    </div>
                    <div class="stat-card emerald">
                        <div class="stat-icon">‚úì</div>
                        <div class="stat-value">${totalConfirmedAttendance}</div>
                        <div class="stat-label">Best√§tigte Anwesenheit</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon">${getIcon('users')}</div>
                        <div class="stat-value">${allEmployees.length}</div>
                        <div class="stat-label">Mitarbeiter</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            üìã Abgeschlossene Schichten - Dokumentation
                        </h3>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        ${shifts.filter(s => s.completed).length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-icon">üìã</div>
                                <div class="empty-title">Keine abgeschlossenen Schichten</div>
                                <div class="empty-subtitle">Schichten werden hier nach Abschluss angezeigt</div>
                            </div>
                        ` : `
                            <div style="padding: 1.5rem;">
                                ${shifts.filter(s => s.completed).sort((a, b) => new Date(b.date) - new Date(a.date)).map(shift => {
                                    const assignedEmployees = (shift.employeeIds || []).map(empId => users.find(u => u.id === empId)).filter(e => e);
                                    const completedBy = users.find(u => u.id === shift.completedBy);
                                    const attendanceCount = Object.keys(shift.attendance || {}).length;
                                    
                                    return `
                                        <div style="background: var(--bg-secondary); border: 2px solid #10b981; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                                <div style="flex: 1;">
                                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                                        <h4 style="font-size: 1.125rem; font-weight: 600; color: var(--text-primary);">
                                                            üìç ${shift.location}
                                                        </h4>
                                                        <span class="badge badge-blue">${shift.type}</span>
                                                        <span class="badge badge-green">‚úì Abgeschlossen</span>
                                                    </div>
                                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                                        üìÖ ${new Date(shift.date).toLocaleDateString('de-DE', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' })} ‚Ä¢ ‚è∞ ${shift.time} ‚Ä¢ ‚òï ${shift.breakMinutes || 0} Min Pause
                                                    </div>
                                                    <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.25rem;">
                                                        Abgeschlossen von ${completedBy?.name} am ${new Date(shift.completedAt).toLocaleDateString('de-DE')} um ${new Date(shift.completedAt).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div style="background: var(--bg-primary); border-radius: 0.5rem; padding: 1rem;">
                                                <div style="font-weight: 600; margin-bottom: 0.75rem; color: var(--text-primary);">
                                                    üë• Anwesenheitsliste (${attendanceCount}/${assignedEmployees.length})
                                                </div>
                                                <table class="table" style="margin: 0;">
                                                    <thead>
                                                        <tr>
                                                            <th>Mitarbeiter</th>
                                                            <th>Status</th>
                                                            <th>Arbeitszeit</th>
                                                            <th>Best√§tigt von</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${assignedEmployees.map(emp => {
                                                            const attendance = shift.attendance?.[emp.id];
                                                            const confirmedBy = attendance?.confirmedBy ? users.find(u => u.id === attendance.confirmedBy) : null;
                                                            
                                                            return `
                                                                <tr style="background: ${attendance?.present ? '#d1fae5' : '#fee2e2'};">
                                                                    <td>
                                                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                                            <div style="width: 28px; height: 28px; background: ${attendance?.present ? '#10b981' : '#dc2626'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.75rem;">
                                                                                ${attendance?.present ? '‚úì' : '‚úó'}
                                                                            </div>
                                                                            ${emp.name}
                                                                        </div>
                                                                    </td>
                                                                    <td>
                                                                        <span class="badge ${attendance?.present ? 'badge-green' : 'badge-red'}">
                                                                            ${attendance?.present ? 'Anwesend' : 'Abwesend'}
                                                                        </span>
                                                                    </td>
                                                                    <td>
                                                                        ${attendance?.hours ? `<strong>${attendance.hours.toFixed(2)} Std</strong>` : '-'}
                                                                    </td>
                                                                    <td style="font-size: 0.875rem; color: var(--text-secondary);">
                                                                        ${confirmedBy ? confirmedBy.name : '-'}
                                                                    </td>
                                                                </tr>
                                                            `;
                                                        }).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `}
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            üìä Wochenstatistik
                        </h3>
                    </div>
                    <div class="card-body">
                        ${renderWeeklyShiftsChart()}
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            üìã Detaillierte Statistiken
                        </h3>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Mitarbeiter</th>
                                    <th>Rolle</th>
                                    <th style="text-align: right;">Schichten</th>
                                    <th style="text-align: right;">Stunden</th>
                                    <th style="text-align: right;">√úberstunden</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allEmployees.map(emp => {
                                    const empShifts = shifts.filter(s => s.employeeId === emp.id);
                                    const empTimeEntries = timeEntries.filter(e => e.userId === emp.id);
                                    const hours = empTimeEntries.reduce((sum, e) => {
                                        if (e.endTime) {
                                            return sum + (new Date(e.endTime).getTime() - new Date(e.startTime).getTime() - (e.pauseDuration || 0));
                                        }
                                        return sum;
                                    }, 0) / (1000 * 60 * 60);
                                    
                                    return `
                                        <tr>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                    <div style="width: 32px; height: 32px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.875rem;">
                                                        ${getInitials(emp.name)}
                                                    </div>
                                                    ${emp.name}
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge badge-${getRoleBadgeColor(emp.role)}">
                                                    ${ROLES[emp.role]?.label || emp.role}
                                                </span>
                                            </td>
                                            <td style="text-align: right;">${empShifts.length}</td>
                                            <td style="text-align: right;">${Math.round(hours)}h</td>
                                            <td style="text-align: right;">
                                                <span class="${emp.overtime > 0 ? 'text-positive' : emp.overtime < 0 ? 'text-negative' : ''}">
                                                    ${emp.overtime > 0 ? '+' : ''}${emp.overtime || 0}h
                                                </span>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function renderWeeklyShiftsChart() {
            const days = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const count = shifts.filter(s => s.date === dateStr).length;
                days.push({
                    label: date.toLocaleDateString('de-DE', { weekday: 'short' }),
                    count: count
                });
            }
            
            const maxCount = Math.max(...days.map(d => d.count), 1);
            
            return `
                <div style="display: flex; align-items: end; gap: 1rem; height: 200px; padding: 1rem;">
                    ${days.map(day => {
                        const height = (day.count / maxCount) * 160;
                        return `
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="font-weight: 600; color: var(--text-primary);">${day.count}</div>
                                <div style="width: 100%; height: ${height}px; background: linear-gradient(180deg, #10b981, #059669); border-radius: 0.25rem 0.25rem 0 0; transition: height 0.3s;"></div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">${day.label}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
        
        function renderSettings() {
            const darkMode = document.body.classList.contains('dark-mode');
            const isAdminUser = currentUser.role === 'admin' || isMainAdmin(currentUser);
            
            return `
                <div style="max-width: 800px; margin: 0 auto;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                ${getIcon('settings')}
                                Einstellungen
                            </h3>
                        </div>
                        <div class="card-body">
                            <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">Darstellung</h4>
                            
                            <div class="toggle-container">
                                <div class="toggle-label">
                                    üåô Dark Mode
                                </div>
                                <div class="toggle-switch ${darkMode ? 'active' : ''}" onclick="toggleDarkMode()">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                            
                            <h4 style="font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; color: var(--text-primary);">Profil</h4>
                            
                            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 0.5rem;">
                                <div class="employee-avatar-large">${getInitials(currentUser.name)}</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--text-primary);">${currentUser.name}</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                        ${ROLES[currentUser.role]?.label || currentUser.role}
                                        ${isMainAdmin(currentUser) ? ' üëë' : ''}
                                    </div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                        ${currentUser.username}
                                    </div>
                                </div>
                            </div>
                            
                            ${currentUser.permissions ? `
                                <h4 style="font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; color: var(--text-primary);">Berechtigungen</h4>
                                <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 0.5rem;">
                                    ${currentUser.permissions.canManageShifts ? `
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; color: #10b981;">
                                            ${getIcon('check')}
                                            <span style="font-size: 0.875rem;">Schichten verwalten</span>
                                        </div>
                                    ` : ''}
                                    ${currentUser.permissions.canManageEmployees ? `
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; color: #10b981;">
                                            ${getIcon('check')}
                                            <span style="font-size: 0.875rem;">Mitarbeiter verwalten</span>
                                        </div>
                                    ` : ''}
                                    ${currentUser.permissions.canAssignShifts ? `
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; color: #10b981;">
                                            ${getIcon('check')}
                                            <span style="font-size: 0.875rem;">Schichten zuweisen</span>
                                        </div>
                                    ` : ''}
                                    ${currentUser.permissions.canViewAllShifts ? `
                                        <div style="display: flex; align-items: center; gap: 0.5rem; color: #10b981;">
                                            ${getIcon('check')}
                                            <span style="font-size: 0.875rem;">Alle Schichten einsehen</span>
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}
                            
                            ${isAdminUser ? `
                                <h4 style="font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; color: var(--text-primary);">
                                    üíæ Datensicherung
                                </h4>
                                
                                <div style="background: #dbeafe; padding: 1.5rem; border-radius: 0.5rem; border-left: 4px solid #3b82f6; margin-bottom: 1rem;">
                                    <div style="display: flex; align-items: start; gap: 1rem;">
                                        <div style="font-size: 1.5rem;">‚ÑπÔ∏è</div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; color: #1e40af; margin-bottom: 0.5rem;">
                                                Backup erstellen
                                            </div>
                                            <div style="font-size: 0.875rem; color: #1e3a8a;">
                                                Sichere alle Mitarbeiter, Schichten und Zeiterfassungen in einer Datei. 
                                                Diese kann sp√§ter wiederhergestellt werden.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <button class="btn-primary" onclick="createBackup()">
                                        ${getIcon('download')}
                                        Backup erstellen
                                    </button>
                                    <button class="btn-primary" style="background: #f59e0b;" onclick="restoreBackup()">
                                        ${getIcon('upload')}
                                        Backup wiederherstellen
                                    </button>
                                </div>
                                
                                <div style="background: #fee2e2; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; border-left: 4px solid #ef4444;">
                                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                                        <div style="font-size: 1.25rem;">‚ö†Ô∏è</div>
                                        <div style="font-size: 0.875rem; color: #991b1b;">
                                            <strong>Wichtig:</strong> Beim Wiederherstellen werden alle aktuellen Daten √ºberschrieben!
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                                <p style="font-size: 0.875rem; color: var(--text-tertiary); margin-bottom: 0.5rem;">
                                    VGF Service Planer v2.0
                                </p>
                                <p style="font-size: 0.75rem; color: var(--text-tertiary);">
                                    Mit Rollen, Berechtigungen, Dark Mode & Backup
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('vgf_darkmode', isDark);
            renderContent();
        }
        
        function createBackup() {
            try {
                const backupData = {
                    version: '2.0',
                    timestamp: new Date().toISOString(),
                    exportedBy: currentUser.username,
                    data: {
                        users: users,
                        shifts: shifts,
                        timeEntries: timeEntries
                    }
                };
                
                const jsonString = JSON.stringify(backupData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                const timestamp = new Date().toISOString().split('T')[0];
                link.download = `VGF_Backup_${timestamp}.json`;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                window.URL.revokeObjectURL(url);
                
                alert('‚úÖ Backup erfolgreich erstellt!\n\nDie Datei wurde heruntergeladen.');
            } catch (error) {
                alert('‚ùå Fehler beim Erstellen des Backups:\n' + error.message);
            }
        }
        
        function restoreBackup() {
            if (!confirm('‚ö†Ô∏è ACHTUNG!\n\nAlle aktuellen Daten werden √ºberschrieben!\n\nM√∂chten Sie wirklich fortfahren?')) {
                return;
            }
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.style.display = 'none';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        if (!backupData.version || !backupData.data) {
                            throw new Error('Ung√ºltiges Backup-Format');
                        }
                        
                        if (backupData.data.users) {
                            users = backupData.data.users;
                            localStorage.setItem('vgf_users', JSON.stringify(users));
                        }
                        
                        if (backupData.data.shifts) {
                            shifts = backupData.data.shifts;
                            localStorage.setItem('vgf_shifts', JSON.stringify(shifts));
                        }
                        
                        if (backupData.data.timeEntries) {
                            timeEntries = backupData.data.timeEntries;
                            localStorage.setItem('vgf_time_entries', JSON.stringify(timeEntries));
                        }
                        
                        alert(`‚úÖ Backup erfolgreich wiederhergestellt!\n\nVersion: ${backupData.version}\nErstellt: ${new Date(backupData.timestamp).toLocaleString('de-DE')}\nVon: ${backupData.exportedBy}\n\nDie Seite wird neu geladen.`);
                        
                        window.location.reload();
                        
                    } catch (error) {
                        alert('‚ùå Fehler beim Wiederherstellen:\n' + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }

        // ============================================
        // MODAL FUNKTIONEN
        // ============================================
        function showAddShiftModal() {
            const employees = users.filter(u => u.role !== 'admin');
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Neue Schicht</h3>
                        <button class="close-btn" onclick="this.closest('.modal-overlay').remove()">
                            ${getIcon('x')}
                        </button>
                    </div>
                    <div class="modal-body">
                        <div style="background: #dbeafe; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 3px solid #3b82f6;">
                            <div style="font-size: 0.875rem; color: #1e40af;">
                                üí° <strong>Tipp:</strong> Sie k√∂nnen mehrere Mitarbeiter pro Schicht zuweisen - entweder jetzt einen ausw√§hlen oder sp√§ter hinzuf√ºgen.
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Mitarbeiter (optional)</label>
                            <select id="shiftEmployee" class="form-input">
                                <option value="">Sp√§ter zuweisen...</option>
                                ${employees.map(emp => `<option value="${emp.id}">${emp.name} (${ROLES[emp.role]?.label})</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Standort *</label>
                            <input type="text" id="shiftLocation" class="form-input" placeholder="z.B. Messehalle 3">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Datum *</label>
                            <input type="date" id="shiftDate" class="form-input" value="${selectedDate}">
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Von *</label>
                                <input type="time" id="shiftStart" class="form-input" value="06:00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bis *</label>
                                <input type="time" id="shiftEnd" class="form-input" value="14:00">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Typ *</label>
                            <select id="shiftType" class="form-input">
                                <option value="Veranstaltung">Veranstaltung</option>
                                <option value="Objektschutz">Objektschutz</option>
                                <option value="Empfang">Empfang</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Pausenzeit (Minuten)</label>
                            <input type="number" id="shiftBreakTime" class="form-input" value="30" min="0" max="120" placeholder="z.B. 30">
                            <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
                                Genehmigte Pausenzeit f√ºr diese Schicht (wird automatisch abgezogen)
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Abbrechen</button>
                            <button class="btn-submit" onclick="addShift()">Erstellen</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function addShift() {
            const employeeId = document.getElementById('shiftEmployee').value;
            const location = document.getElementById('shiftLocation').value;
            const date = document.getElementById('shiftDate').value;
            const startTime = document.getElementById('shiftStart').value;
            const endTime = document.getElementById('shiftEnd').value;
            const type = document.getElementById('shiftType').value;
            const breakTime = parseInt(document.getElementById('shiftBreakTime').value) || 0;
            
            if (location && date) {
                const newShift = {
                    id: Date.now().toString(),
                    employeeIds: employeeId ? [employeeId] : [],
                    location: location,
                    date: date,
                    time: `${startTime}-${endTime}`,
                    type: type,
                    breakMinutes: breakTime,
                    viewedBy: [],
                    attendance: {},
                    completed: false,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser.id
                };
                
                shifts.push(newShift);
                saveData();
                document.querySelector('.modal-overlay').remove();
                renderContent();
                
                const syncMessage = isOnline && !offlineMode ? 
                    ' (wurde mit allen Ger√§ten synchronisiert)' : 
                    ' (wird synchronisiert wenn Online)';
                
                showNotification(`Schicht erstellt${syncMessage}`, 'success');
            } else {
                showNotification('Bitte mindestens Standort und Datum ausf√ºllen', 'error');
            }
        }
        
        function showAddEmployeeModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Neuer Mitarbeiter</h3>
                        <button class="close-btn" onclick="this.closest('.modal-overlay').remove()">
                            ${getIcon('x')}
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Name *</label>
                            <input type="text" id="empName" class="form-input" placeholder="Max Mustermann">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Benutzername *</label>
                            <input type="text" id="empUsername" class="form-input" placeholder="max">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Passwort *</label>
                            <input type="password" id="empPassword" class="form-input" placeholder="Mindestens 6 Zeichen">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Bewacher-Nr.</label>
                            <input type="text" id="empRegNumber" class="form-input" placeholder="BW-12345">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Rolle / Position</label>
                            <select id="empRole" class="form-input">
                                ${Object.keys(ROLES).filter(r => r !== 'admin').map(role => 
                                    `<option value="${role}">${ROLES[role].label}</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">E-Mail</label>
                            <input type="email" id="empEmail" class="form-input" placeholder="mitarbeiter@vgf-service.de">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Telefon</label>
                            <input type="tel" id="empPhone" class="form-input" placeholder="+49 151 12345678">
                        </div>
                        
                        <div class="permissions-group">
                            <div class="permissions-title">
                                ${getIcon('key')}
                                Berechtigungen
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="permManageShifts">
                                <label for="permManageShifts">Schichten verwalten</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="permManageEmployees">
                                <label for="permManageEmployees">Mitarbeiter verwalten</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="permAssignShifts">
                                <label for="permAssignShifts">Schichten zuweisen</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="permViewAll">
                                <label for="permViewAll">Alle Schichten sehen</label>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Abbrechen</button>
                            <button class="btn-submit" onclick="addEmployee()">Erstellen</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function addEmployee() {
            const name = document.getElementById('empName').value;
            const username = document.getElementById('empUsername').value;
            const password = document.getElementById('empPassword').value;
            const regNumber = document.getElementById('empRegNumber').value;
            const role = document.getElementById('empRole').value;
            const email = document.getElementById('empEmail').value;
            const phone = document.getElementById('empPhone').value;
            
            if (!name || !username || !password) {
                showNotification('Bitte Name, Benutzername und Passwort ausf√ºllen', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Das Passwort muss mindestens 6 Zeichen lang sein.', 'error');
                return;
            }
            
            if (username === MAIN_ADMIN.username) {
                showNotification('Dieser Benutzername ist f√ºr den Hauptadmin reserviert!', 'error');
                return;
            }
            
            if (users.find(u => u.username === username)) {
                showNotification('Dieser Benutzername existiert bereits!', 'error');
                return;
            }
            
            const permissions = {
                canManageShifts: document.getElementById('permManageShifts').checked,
                canManageEmployees: document.getElementById('permManageEmployees').checked,
                canAssignShifts: document.getElementById('permAssignShifts').checked,
                canViewAllShifts: document.getElementById('permViewAll').checked,
                canEditOwnShifts: true
            };
            
            const newEmployee = {
                id: Date.now().toString(),
                name: name,
                username: username,
                password: password,
                role: role,
                status: 'aktiv',
                hours: 0,
                overtime: 0,
                regNumber: regNumber,
                pushNotification: false,
                lastSeen: new Date().toLocaleString('de-DE'),
                email: email,
                phone: phone,
                permissions: permissions,
                createdBy: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            users.push(newEmployee);
            saveData();
            document.querySelector('.modal-overlay').remove();
            renderContent();
            
            const syncMessage = isOnline && !offlineMode ? 
                ' (wurde mit allen Ger√§ten synchronisiert)' : 
                ' (wird synchronisiert wenn Online)';
            
            showNotification(`Mitarbeiter ${name} erstellt${syncMessage}`, 'success');
        }
        
        function addMyselfToShift(shiftId) {
            const shift = shifts.find(s => s.id === shiftId);
            if (!shift) {
                showNotification('Fehler: Schicht nicht gefunden!', 'error');
                return;
            }
            
            if (!shift.employeeIds) shift.employeeIds = [];
            
            if (shift.employeeIds.includes(currentUser.id)) {
                showNotification('Sie sind bereits f√ºr diese Schicht eingetragen!', 'error');
                return;
            }
            
            shift.employeeIds.push(currentUser.id);
            saveData();
            renderContent();
            
            showNotification(`‚úÖ Sie wurden f√ºr die Schicht eingetragen!`, 'success');
        }
        
        function addEmployeeToShift(shiftId) {
            const shift = shifts.find(s => s.id === shiftId);
            if (!shift) return;
            
            const availableEmployees = users.filter(u => 
                u.role !== 'admin' && 
                !(shift.employeeIds || []).includes(u.id)
            );
            
            if (availableEmployees.length === 0) {
                showNotification('Alle Mitarbeiter sind bereits dieser Schicht zugewiesen.', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Mitarbeiter hinzuf√ºgen</h3>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">
                            ${getIcon('x')}
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Standort: ${shift.location}</label>
                            <label class="form-label">Datum: ${new Date(shift.date).toLocaleDateString('de-DE')} ‚Ä¢ ${shift.time}</label>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Mitarbeiter ausw√§hlen</label>
                            <select id="addEmployeeSelect" class="form-input">
                                <option value="">-- Mitarbeiter w√§hlen --</option>
                                ${availableEmployees.map(emp => `
                                    <option value="${emp.id}">${emp.name} (${ROLES[emp.role]?.label})</option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Abbrechen</button>
                            <button class="btn-primary" onclick="confirmAddEmployeeToShift('${shiftId}')">Hinzuf√ºgen</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function confirmAddEmployeeToShift(shiftId) {
            const employeeId = document.getElementById('addEmployeeSelect').value;
            if (!employeeId) {
                showNotification('Bitte w√§hlen Sie einen Mitarbeiter aus.', 'error');
                return;
            }
            
            const shift = shifts.find(s => s.id === shiftId);
            if (!shift) return;
            
            if (!shift.employeeIds) shift.employeeIds = [];
            
            if (!shift.employeeIds.includes(employeeId)) {
                shift.employeeIds.push(employeeId);
                saveData();
                
                const employee = users.find(u => u.id === employeeId);
                showNotification(`‚úÖ ${employee?.name} wurde der Schicht hinzugef√ºgt!`, 'success');
            }
            
            document.querySelector('.modal-overlay').remove();
            renderContent();
        }
        
        function removeEmployeeFromShift(shiftId, employeeId) {
            console.log('removeEmployeeFromShift called:', shiftId, employeeId);
            
            const shift = shifts.find(s => s.id === shiftId);
            const employee = users.find(u => u.id === employeeId);
            
            if (!shift || !employee) {
                showNotification('Fehler: Schicht oder Mitarbeiter nicht gefunden!', 'error');
                return;
            }
            
            shift.employeeIds = (shift.employeeIds || []).filter(id => id !== employeeId);
            saveData();
            renderContent();
            
            showNotification(`‚úÖ ${employee.name} wurde entfernt!`, 'success');
        }
        
        function toggleAttendance(shiftId, employeeId) {
            const shift = shifts.find(s => s.id === shiftId);
            if (!shift) return;
            
            if (!shift.attendance) shift.attendance = {};
            
            const employee = users.find(u => u.id === employeeId);
            const currentStatus = shift.attendance[employeeId]?.present || false;
            
            if (currentStatus) {
                delete shift.attendance[employeeId];
            } else {
                const timeEntry = timeEntries.find(e => 
                    e.userId === employeeId && 
                    e.date === shift.date && 
                    e.endTime
                );
                
                const workedMs = timeEntry ? 
                    (new Date(timeEntry.endTime).getTime() - new Date(timeEntry.startTime).getTime() - (timeEntry.pauseDuration || 0)) : 
                    0;
                const workedHours = (workedMs / (1000 * 60 * 60)).toFixed(2);
                
                shift.attendance[employeeId] = {
                    present: true,
                    confirmedBy: currentUser.id,
                    confirmedAt: new Date().toISOString(),
                    hours: parseFloat(workedHours)
                };
            }
            
            saveData();
            renderContent();
            
            showNotification(currentStatus ? 
                `${employee?.name} als abwesend markiert` : 
                `‚úì ${employee?.name} Anwesenheit best√§tigt`, 'success');
        }
        
        function completeShift(shiftId) {
            const shift = shifts.find(s => s.id === shiftId);
            if (!shift) return;
            
            const assignedCount = (shift.employeeIds || []).length;
            const confirmedCount = Object.keys(shift.attendance || {}).length;
            
            if (confirmedCount === 0) {
                showNotification('Bitte best√§tigen Sie mindestens einen Mitarbeiter bevor Sie die Schicht abschlie√üen.', 'error');
                return;
            }
            
            if (confirm(`Schicht abschlie√üen?\n\n${confirmedCount} von ${assignedCount} Mitarbeiter(n) best√§tigt.\n\nNach dem Abschluss k√∂nnen keine √Ñnderungen mehr vorgenommen werden.`)) {
                shift.completed = true;
                shift.completedBy = currentUser.id;
                shift.completedAt = new Date().toISOString();
                
                saveData();
                renderContent();
                
                showNotification(`‚úÖ Schicht abgeschlossen!\n\nStandort: ${shift.location}\nBest√§tigte Mitarbeiter: ${confirmedCount}`, 'success');
            }
        }
        
        function editShift(id) {
            const shift = shifts.find(s => s.id === id);
            if (!shift) return;
            
            const [startTime, endTime] = shift.time.split('-');
            const employees = users.filter(u => u.role !== 'admin');
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Schicht bearbeiten</h3>
                        <button class="close-btn" onclick="this.closest('.modal-overlay').remove()">
                            ${getIcon('x')}
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Standort *</label>
                            <input type="text" id="editShiftLocation" class="form-input" value="${shift.location}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Datum *</label>
                            <input type="date" id="editShiftDate" class="form-input" value="${shift.date}">
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Von *</label>
                                <input type="time" id="editShiftStart" class="form-input" value="${startTime}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bis *</label>
                                <input type="time" id="editShiftEnd" class="form-input" value="${endTime}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Typ *</label>
                            <select id="editShiftType" class="form-input">
                                <option value="Veranstaltung" ${shift.type === 'Veranstaltung' ? 'selected' : ''}>Veranstaltung</option>
                                <option value="Objektschutz" ${shift.type === 'Objektschutz' ? 'selected' : ''}>Objektschutz</option>
                                <option value="Empfang" ${shift.type === 'Empfang' ? 'selected' : ''}>Empfang</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Pausenzeit (Minuten)</label>
                            <input type="number" id="editShiftBreakTime" class="form-input" value="${shift.breakMinutes || 0}" min="0" max="120">
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Abbrechen</button>
                            <button class="btn-submit" onclick="updateShift('${id}')">Speichern</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function updateShift(id) {
            const shift = shifts.find(s => s.id === id);
            if (!shift) return;
            
            shift.location = document.getElementById('editShiftLocation').value;
            shift.date = document.getElementById('editShiftDate').value;
            const startTime = document.getElementById('editShiftStart').value;
            const endTime = document.getElementById('editShiftEnd').value;
            shift.time = `${startTime}-${endTime}`;
            shift.type = document.getElementById('editShiftType').value;
            shift.breakMinutes = parseInt(document.getElementById('editShiftBreakTime').value) || 0;
            
            saveData();
            document.querySelector('.modal-overlay').remove();
            renderContent();
            showNotification('‚úÖ Schicht aktualisiert!', 'success');
        }
        
        function deleteShift(id) {
            if (confirm('M√∂chten Sie diese Schicht wirklich l√∂schen?')) {
                shifts = shifts.filter(s => s.id !== id);
                saveData();
                renderContent();
                showNotification('‚úÖ Schicht gel√∂scht!', 'success');
            }
        }
        
        function editEmployee(id) {
            const employee = users.find(u => u.id === id);
            if (!employee) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Mitarbeiter bearbeiten</h3>
                        <button class="close-btn" onclick="this.closest('.modal-overlay').remove()">
                            ${getIcon('x')}
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Name *</label>
                            <input type="text" id="editEmpName" class="form-input" value="${employee.name}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Benutzername *</label>
                            <input type="text" id="editEmpUsername" class="form-input" value="${employee.username}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Passwort (leer lassen f√ºr keine √Ñnderung)</label>
                            <input type="password" id="editEmpPassword" class="form-input" placeholder="Neues Passwort">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Bewacher-Nr.</label>
                            <input type="text" id="editEmpRegNumber" class="form-input" value="${employee.regNumber || ''}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Rolle / Position</label>
                            <select id="editEmpRole" class="form-input">
                                ${Object.keys(ROLES).filter(r => r !== 'admin').map(role => 
                                    `<option value="${role}" ${employee.role === role ? 'selected' : ''}>${ROLES[role].label}</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">E-Mail</label>
                            <input type="email" id="editEmpEmail" class="form-input" value="${employee.email || ''}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Telefon</label>
                            <input type="tel" id="editEmpPhone" class="form-input" value="${employee.phone || ''}">
                        </div>
                        
                        <div class="permissions-group">
                            <div class="permissions-title">
                                ${getIcon('key')}
                                Berechtigungen
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="editPermManageShifts" ${employee.permissions?.canManageShifts ? 'checked' : ''}>
                                <label for="editPermManageShifts">Schichten verwalten</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="editPermManageEmployees" ${employee.permissions?.canManageEmployees ? 'checked' : ''}>
                                <label for="editPermManageEmployees">Mitarbeiter verwalten</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="editPermAssignShifts" ${employee.permissions?.canAssignShifts ? 'checked' : ''}>
                                <label for="editPermAssignShifts">Schichten zuweisen</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="editPermViewAll" ${employee.permissions?.canViewAllShifts ? 'checked' : ''}>
                                <label for="editPermViewAll">Alle Schichten sehen</label>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Abbrechen</button>
                            <button class="btn-submit" onclick="updateEmployee('${id}')">Speichern</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function updateEmployee(id) {
            const employee = users.find(u => u.id === id);
            if (!employee) return;
            
            const name = document.getElementById('editEmpName').value;
            const username = document.getElementById('editEmpUsername').value;
            const password = document.getElementById('editEmpPassword').value;
            
            if (!name || !username) {
                showNotification('Bitte Name und Benutzername ausf√ºllen', 'error');
                return;
            }
            
            const existingUser = users.find(u => u.username === username && u.id !== id);
            if (existingUser) {
                showNotification('Dieser Benutzername wird bereits von einem anderen Mitarbeiter verwendet!', 'error');
                return;
            }
            
            if (password && password.length < 6) {
                showNotification('Das Passwort muss mindestens 6 Zeichen lang sein.', 'error');
                return;
            }
            
            employee.name = name;
            employee.username = username;
            if (password) employee.password = password;
            employee.regNumber = document.getElementById('editEmpRegNumber').value;
            employee.role = document.getElementById('editEmpRole').value;
            employee.email = document.getElementById('editEmpEmail').value;
            employee.phone = document.getElementById('editEmpPhone').value;
            employee.permissions = {
                canManageShifts: document.getElementById('editPermManageShifts').checked,
                canManageEmployees: document.getElementById('editPermManageEmployees').checked,
                canAssignShifts: document.getElementById('editPermAssignShifts').checked,
                canViewAllShifts: document.getElementById('editPermViewAll').checked,
                canEditOwnShifts: true
            };
            
            saveData();
            document.querySelector('.modal-overlay').remove();
            renderContent();
            showNotification(`‚úÖ Mitarbeiter ${name} wurde aktualisiert!`, 'success');
        }
        
        function deleteEmployee(id) {
            const employee = users.find(u => u.id === id);
            if (!employee) return;
            
            if (confirm(`M√∂chten Sie ${employee.name} wirklich l√∂schen?\n\nAlle zugewiesenen Schichten werden freigegeben.`)) {
                users = users.filter(u => u.id !== id);
                shifts = shifts.map(s => {
                    if (s.employeeIds && s.employeeIds.includes(id)) {
                        return {
                            ...s,
                            employeeIds: s.employeeIds.filter(eid => eid !== id)
                        };
                    }
                    return s;
                });
                saveData();
                renderContent();
                showNotification(`‚úÖ ${employee.name} wurde gel√∂scht.`, 'success');
            }
        }
        
        function searchEmployees(term) {
            const employees = users.filter(u => u.role !== 'admin');
            const filtered = employees.filter(emp => 
                emp.name.toLowerCase().includes(term.toLowerCase()) ||
                emp.regNumber.toLowerCase().includes(term.toLowerCase())
            );
            
            const list = document.getElementById('employeeList');
            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-title">Keine Mitarbeiter gefunden</div></div>';
            } else {
                list.innerHTML = filtered.map(emp => {
                    const empShifts = shifts.filter(s => s.employeeId === emp.id);
                    const perms = [];
                    if (emp.permissions) {
                        if (emp.permissions.canManageShifts) perms.push('Schichten verwalten');
                        if (emp.permissions.canManageEmployees) perms.push('Personal');
                        if (emp.permissions.canAssignShifts) perms.push('Zuweisung');
                    }
                    
                    return `
                        <div class="employee-item">
                            <div class="employee-left">
                                <div class="employee-avatar-large">${getInitials(emp.name)}</div>
                                <div class="employee-details">
                                    <div class="employee-name">
                                        ${emp.name}
                                        <span class="badge badge-${getRoleBadgeColor(emp.role)}">
                                            ${ROLES[emp.role]?.label || emp.role}
                                        </span>
                                    </div>
                                    <div class="employee-meta">
                                        ${emp.regNumber || emp.username} ‚Ä¢ ${empShifts.length} Schichten
                                    </div>
                                    ${perms.length > 0 ? `
                                        <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.25rem;">
                                            üîë ${perms.join(', ')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="employee-actions">
                                <button class="btn-icon edit" onclick="editEmployee('${emp.id}')">
                                    ${getIcon('edit')}
                                </button>
                                <button class="btn-icon delete" onclick="deleteEmployee('${emp.id}')">
                                    ${getIcon('trash')}
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
        }

        function getRoleBadgeColor(role) {
            const colors = {
                admin: 'red',
                kleinadmin: 'orange',
                einsatzleiter: 'purple',
                supervisor: 'purple',
                teamleader: 'blue',
                security_guard: 'gray',
                trainee: 'gray',
                doorman: 'gray',
                event_security: 'gray',
                ordner: 'gray',
                reception: 'gray'
            };
            return colors[role] || 'gray';
        }

        function getIcon(name) {
            const icons = {
                chart: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>',
                calendar: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
                users: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',
                clock: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',
                map: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',
                download: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',
                upload: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>',
                settings: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 6l-4.24 4.24M23 12h-6m-6 0H1m18.36 5.64l-4.24-4.24m0-6l-4.24-4.24"></path></svg>',
                bell: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>',
                plus: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',
                edit: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',
                trash: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',
                search: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>',
                check: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>',
                alert: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>',
                mail: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>',
                key: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>',
                x: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>'
            };
            return icons[name] || '';
        }
        
        function markAllShiftsAsViewed() {
            let updated = false;
            shifts.forEach(shift => {
                if (!shift.viewedBy) shift.viewedBy = [];
                if (!shift.viewedBy.includes(currentUser.id)) {
                    shift.viewedBy.push(currentUser.id);
                    updated = true;
                }
            });
            if (updated) {
                saveData();
            }
        }
        
        function checkAndStartShiftTimer() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const currentShift = shifts.find(shift => {
                if (shift.date !== today) return false;
                if (!(shift.employeeIds || []).includes(currentUser.id)) return false;
                
                const [start, end] = shift.time.split('-');
                const [startH, startM] = start.split(':').map(Number);
                const [endH, endM] = end.split(':').map(Number);
                const shiftStart = startH * 60 + startM;
                const shiftEnd = endH * 60 + endM;
                
                return currentTime >= shiftStart && currentTime <= shiftEnd;
            });
            
            if (currentShift) {
                const todayEntries = timeEntries.filter(e => 
                    e.userId === currentUser.id && 
                    e.date === today &&
                    !e.endTime
                );
                
                if (todayEntries.length === 0) {
                    console.log('Auto-starting timer for current shift');
                    startTimer();
                }
            }
        }

        // ============================================
        // START APP
        // ============================================
        init();
    </script>
</body>
</html>